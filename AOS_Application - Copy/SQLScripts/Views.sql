USE AOSTEST

/************************* viewPricingMethod *************************/

IF OBJECT_ID ('viewPricingMethod', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPricingMethod] 
END
GO
CREATE VIEW [dbo].[viewPricingMethod]
AS
SELECT    TOP 10 PricingMethod
FROM         dbo.LIST_PricingMethod
ORDER BY SortSequence
GO

/************************* viewWorkOrderItemPricing *************************/

IF OBJECT_ID ('viewWorkOrderItemPricing', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderItemPricing] 
END
GO
CREATE VIEW [dbo].[viewWorkOrderItemPricing]
AS
SELECT        ISNULL(PRICEUNITS, 0) AS PRICEUNITS, ISNULL(PRICEUOM, '') AS PRICEUOM, ISNULL(UNITPRICE, 0.0000) AS UNITPRICE, ISNULL(STANDARDCOSTUNITS, 0) AS STANDARDCOSTUNITS, 
                         ISNULL(STANDARDCOSTUOM, '') AS STANDARDCOSTUOM, ISNULL(STANDARDUNITCOST, 0.0000) AS STANDARDUNITCOST, ISNULL(ACTUALCOSTUNITS, 0) AS ACTUALCOSTUNITS, ISNULL(ACTUALCOSTUOM, '') 
                         AS ACTUALCOSTUOM, ISNULL(ACTUALUNITCOST, 0.0000) AS ACTUALUNITCOST, PRODUCTID, WORKORDERITEMNUMBER
FROM            dbo.WORKORDERITEM

GO

/************************* viewWorkOrderItemsScreen *************************/

IF OBJECT_ID ('viewWorkOrderItemsScreen', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderItemsScreen] 
END
GO
CREATE VIEW [dbo].[viewWorkOrderItemsScreen]
AS
SELECT     dbo.WORKORDERITEM.WORKORDERITEMNUMBER, dbo.WORKORDERITEM.WORKORDERNUMBER, dbo.WORKORDERITEM.ITEMTYPE, 
                      dbo.WORKORDERITEM.ITEMID, dbo.WORKORDERITEM.ITEMDESCRIPTION, dbo.WORKORDERITEM.PRODUCTID, dbo.WORKORDERITEM.PRODUCTDESC, 
                      dbo.WORKORDERITEM.CONTAINER, dbo.WORKORDERITEM.QTY, dbo.WORKORDERITEM.INVITEMNUMBER, dbo.WORKORDERITEM.ITEMCOMMENTS, 
                      dbo.WORKORDERITEM.LOTNUMBER, dbo.WORKORDERITEM.WAREHOUSELOCATION, 
					  ISNULL(dbo.WORKORDERITEM.BILLABLE,0) AS  BILLABLE,
					  dbo.WORKORDERITEM.UNITCOST, 
                      dbo.WORKORDERITEM.ITEMPRICE, dbo.WORKORDERITEM.ITEMPROFIT, dbo.WORKORDERITEM.UNITORCONTAINER, dbo.WORKORDERITEM.UNITS, 
                      dbo.WORKORDERITEM.UOM,  
                      dbo.WORKORDERITEM.SOURCETYPE, 
					  dbo.WORKORDERITEM.SOURCEDOCUMENT, 
					  (CASE WHEN dbo.WORKORDERITEM.SOURCETYPE = 'PRCH' THEN 
							(SELECT PURCHASEITEMSTATUS FROM PURCHASEITEM WHERE PURCHASEITEMID =dbo.WORKORDERITEM.SOURCEDOCUMENT)						
						WHEN dbo.WORKORDERITEM.SOURCETYPE = 'PORD' THEN 
							(SELECT ORDERSTATUS FROM PRODORDER WHERE PRODORDERNUM =dbo.WORKORDERITEM.SOURCEDOCUMENT)
						WHEN dbo.WORKORDERITEM.SOURCETYPE = 'INV' THEN 
							(SELECT ITEMSTATUS FROM INVITEM WHERE INVITEMNUMBER =dbo.WORKORDERITEM.SOURCEDOCUMENT) END ) AS SOURCESTATUS,
					  dbo.WORKORDERITEM.WORKORDERITEMSTATUS, 
                      dbo.WORKORDERITEM.CUSTOMERPO, dbo.WORKORDERITEM.SHIPMENTITEMNUMBER, dbo.WORKORDERITEM.INVOICEITEMNUMBER, 
                      dbo.WORKORDERITEM.TOTALVOLUME, dbo.WORKORDERITEM.VOLUMEUOM, dbo.WORKORDERITEM.TOTALWEIGHT, dbo.WORKORDERITEM.WEIGHTUOM, 
                      dbo.WORKORDERITEM.DOTIDNumber, dbo.WORKORDERITEM.HAZMATID, dbo.WORKORDERITEM.HAZMATCLASS, 
                      dbo.WORKORDERITEM.HAZMATPACKAGEGROUP, dbo.WORKORDERITEM.CLASSRATE, dbo.WORKORDERITEM.DOTDESC, dbo.WORKORDERITEM.HAZMATDESC, 
                      dbo.WORKORDERITEM.UNLINE, 
					  ISNULL(dbo.WORKORDERITEM.ISHAZARDOUS,0) AS ISHAZARDOUS, 
					  dbo.WORKORDERITEM.ITEMNOTES, dbo.WORKORDERITEM.CREATEDTIME, 
                      dbo.WORKORDERITEM.CREATEDBY, dbo.WORKORDERITEM.MODIFIEDTIME, dbo.WORKORDERITEM.MODIFIEDBY, dbo.WORKORDERITEM.LD1, 
                      dbo.WORKORDERITEM.LD2, dbo.WORKORDERITEM.LD3, dbo.WORKORDERITEM.CUSTITEMID, dbo.INVITEM.ITEMSTATUS,
					  dbo.WORKORDERITEM.STANDARDUNITCOST, 
					  dbo.WORKORDERITEM.UNITPRICE,
					  dbo.WORKORDERITEM.PRICEUNITS,
						dbo.WORKORDERITEM.PRICEUOM,				
						dbo.WORKORDERITEM.STANDARDCOSTUNITS,
						dbo.WORKORDERITEM.STANDARDCOSTUOM,					
						dbo.WORKORDERITEM.ACTUALCOSTUNITS,
						dbo.WORKORDERITEM.ACTUALCOSTUOM,

	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL

(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END AS EXTPRICE,
	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  

ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END AS EXTCOST,
	
	ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) AS ACTUALUNITCOST,

	ISNULL(((CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL

(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END) - (CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL

(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END)),0) AS EXTPROFIT
	

FROM         dbo.WORKORDERITEM LEFT OUTER JOIN
                      dbo.INVITEM ON dbo.WORKORDERITEM.INVITEMNUMBER = dbo.INVITEM.INVITEMNUMBER
GO




/************************* viewCustomerNameByPriceList *************************/
IF OBJECT_ID ('viewCustomerNameByPriceList', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewCustomerNameByPriceList] 
END
GO


CREATE VIEW [dbo].[viewCustomerNameByPriceList]
AS
SELECT E.PRODUCTID,  E.CUSTID, CUSTNAME,WEIGHTPRICE,VOLUMEPRICE,VOLUMEUOM,WEIGHTUOM FROM
(SELECT dbo.PRICELIST.CUSTID ,PRODUCTID,MAX(EFFECTIVEDATE) AS EFFECTIVEDATE
FROM  dbo.PRICELIST 
WHERE EFFECTIVEDATE <= GETDATE()
GROUP BY dbo.PRICELIST.CUSTID ,PRODUCTID) A
CROSS APPLY
(SELECT TOP 1 PRICELISTID, PL.CUSTID, PRODUCTID, CUSTNAME,EFFECTIVEDATE,WEIGHTPRICE,VOLUMEPRICE,VOLUMEUOM,WEIGHTUOM 
FROM PRICELIST PL 
INNER JOIN dbo.CUSTOMER ON PL.CUSTID = dbo.CUSTOMER.CUSTID
WHERE PL.CUSTID = A.CUSTID AND PL.PRODUCTID = A.PRODUCTID AND PL.EFFECTIVEDATE = A.EFFECTIVEDATE) E

GO


/************************* viewPriceListProducts *************************/
IF OBJECT_ID ('viewPriceListProducts', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPriceListProducts] 
END
GO


CREATE VIEW [dbo].[viewPriceListProducts]
AS
SELECT       TOP (100) PERCENT E.CUSTID, E.PRODUCTID, E.PRODUCTDESC, E.CONTAINER, E.VOLUMEUNITS, E.VOLUMEUOM, E.WEIGHTUNITS, E.WEIGHTUOM, E.DESC2

FROM            (SELECT       PRODUCTID, MAX(EFFECTIVEDATE) AS EFFECTIVEDATE
                          FROM            dbo.PRICELIST
                          WHERE        EFFECTIVEDATE <= GETDATE()
                          GROUP BY dbo.PRICELIST. PRODUCTID) A CROSS APPLY
                             (SELECT        TOP 1 PRICELISTID, PL.CUSTID, PL.PRODUCTID, EFFECTIVEDATE, p.PRODUCTDESC, p.CONTAINER, p.VOLUMEUNITS, p.VOLUMEUOM, p.WEIGHTUNITS, p.WEIGHTUOM, p.DESC2
                               FROM            PRICELIST PL INNER JOIN
                                                         dbo.PRODUCT p ON PL.PRODUCTID = p.PRODUCTID
                               WHERE  PL.PRODUCTID = A.PRODUCTID AND PL.EFFECTIVEDATE = A.EFFECTIVEDATE) E
ORDER BY E.PRODUCTDESC


GO


/************************* viewWorkOrderItemsScreen *************************/
IF OBJECT_ID ('viewWorkOrderItemsScreen', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderItemsScreen] 
END
GO



CREATE VIEW [dbo].[viewWorkOrderItemsScreen]
AS
SELECT     dbo.WORKORDERITEM.WORKORDERITEMNUMBER, dbo.WORKORDERITEM.WORKORDERNUMBER, dbo.WORKORDERITEM.ITEMTYPE, 
                      dbo.WORKORDERITEM.ITEMID, dbo.WORKORDERITEM.ITEMDESCRIPTION, dbo.WORKORDERITEM.PRODUCTID, dbo.WORKORDERITEM.PRODUCTDESC, 
                      dbo.WORKORDERITEM.CONTAINER, dbo.WORKORDERITEM.QTY, dbo.WORKORDERITEM.INVITEMNUMBER, dbo.WORKORDERITEM.ITEMCOMMENTS, 
                      dbo.WORKORDERITEM.LOTNUMBER, dbo.WORKORDERITEM.WAREHOUSELOCATION, dbo.WORKORDERITEM.BILLABLE, dbo.WORKORDERITEM.UNITCOST, 
                      dbo.WORKORDERITEM.ITEMPRICE, dbo.WORKORDERITEM.ITEMPROFIT, dbo.WORKORDERITEM.UNITORCONTAINER, dbo.WORKORDERITEM.UNITS, 
                      dbo.WORKORDERITEM.UOM,  
                      dbo.WORKORDERITEM.SOURCETYPE, dbo.WORKORDERITEM.SOURCEDOCUMENT, dbo.WORKORDERITEM.WORKORDERITEMSTATUS, 
                      dbo.WORKORDERITEM.CUSTOMERPO, dbo.WORKORDERITEM.SHIPMENTITEMNUMBER, dbo.WORKORDERITEM.INVOICEITEMNUMBER, 
                      dbo.WORKORDERITEM.TOTALVOLUME, dbo.WORKORDERITEM.VOLUMEUOM, dbo.WORKORDERITEM.TOTALWEIGHT, dbo.WORKORDERITEM.WEIGHTUOM, 
                      dbo.WORKORDERITEM.DOTIDNumber, dbo.WORKORDERITEM.HAZMATID, dbo.WORKORDERITEM.HAZMATCLASS, 
                      dbo.WORKORDERITEM.HAZMATPACKAGEGROUP, dbo.WORKORDERITEM.CLASSRATE, dbo.WORKORDERITEM.DOTDESC, dbo.WORKORDERITEM.HAZMATDESC, 
                      dbo.WORKORDERITEM.UNLINE, dbo.WORKORDERITEM.ISHAZARDOUS, dbo.WORKORDERITEM.ITEMNOTES, dbo.WORKORDERITEM.CREATEDTIME, 
                      dbo.WORKORDERITEM.CREATEDBY, dbo.WORKORDERITEM.MODIFIEDTIME, dbo.WORKORDERITEM.MODIFIEDBY, dbo.WORKORDERITEM.LD1, 
                      dbo.WORKORDERITEM.LD2, dbo.WORKORDERITEM.LD3, dbo.WORKORDERITEM.CUSTITEMID, dbo.INVITEM.ITEMSTATUS,
					  dbo.WORKORDERITEM.STANDARDUNITCOST, dbo.WORKORDERITEM.UNITPRICE,

	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END AS EXTPRICE,
	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END AS EXTCOST,
	CASE WHEN
	ISNULL((CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.ACTUALCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  END),0)=0 
	THEN
		CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  END
	ELSE
		CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.ACTUALCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  END
	END AS ACTUALUNITCOST,

	ISNULL(((CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END) - (CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END)),0) AS EXTPROFIT
	

FROM         dbo.WORKORDERITEM LEFT OUTER JOIN
                      dbo.INVITEM ON dbo.WORKORDERITEM.INVITEMNUMBER = dbo.INVITEM.INVITEMNUMBER



GO


---------------------------- 14.2 UAT issues ----------------------------------------------------

IF OBJECT_ID ('viewRptInventoryProfitAndLossAnalysis', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptInventoryProfitAndLossAnalysis] 
END

GO

CREATE VIEW [dbo].[viewRptInventoryProfitAndLossAnalysis]
AS

SELECT     w.WORKORDERNUMBER, w.WORKORDERDATE,w.SUBTOTAL,c.CUSTNAME,WI.Cost, WI.Price, WI.Profit, WI.EXTPRICE,WI.STANDARDCOST,WI.ACTUALUNITCOST,WI.STDPROFIT,WI.ACTPROFIT
FROM dbo.WORKORDER AS w	
	INNER JOIN dbo.CUSTOMER AS c ON w.CUSTID = c.CUSTID
	INNER JOIN (SELECT WORKORDERNUMBER, SUM(b.STANDARDUNITCOST * b.UNITS) AS Cost, 
				SUM(b.EXTPRICE) AS Price, 
				SUM(b.EXTPRICE - (b.STANDARDUNITCOST * b.UNITS)) AS Profit,
				SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE,0) * ISNULL(b.PRICEUNITS,0) * ISNULL(b.QTY,0)  ELSE ISNULL(b.UNITPRICE,0) *  ISNULL(b.QTY,0) END) AS EXTPRICE,

				SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL( b.QTY,0)  END) AS STANDARDCOST,
						
				SUM(CASE WHEN
				ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END),0)=0 
				THEN
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.QTY,0)  END
				ELSE
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END
				END) AS ACTUALUNITCOST,
	
				SUM(ISNULL(((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL( b.QTY,0)  END)-(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE,0) * ISNULL(b.PRICEUNITS,0) * ISNULL(b.QTY,0)  ELSE ISNULL(b.UNITPRICE,0) *  ISNULL(b.QTY,0) END)),0)) AS STDPROFIT,
	
				SUM(ISNULL(((		
				CASE WHEN
				ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END),0)=0 
				THEN
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.QTY,0)  END
				ELSE
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END
				END	
				)-
				(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE,0) * ISNULL(b.PRICEUNITS,0) * ISNULL(b.QTY,0)  ELSE ISNULL(b.UNITPRICE,0) *  ISNULL(b.QTY,0) END)),0)) AS ACTPROFIT		
				FROM         dbo.WORKORDERITEM AS b
				WHERE b.BILLABLE = 1
				GROUP BY WORKORDERNUMBER
				) WI ON WI.WORKORDERNUMBER = w.WORKORDERNUMBER
 WHERE w.ORDERSTATUS NOT IN ('PENDING', 'CANCELLED')
 

GO



/************************* viewPriceListProducts *************************/
IF OBJECT_ID ('viewAuditLog', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAuditLog] 
END
GO


CREATE VIEW [dbo].[viewAuditLog]
AS
SELECT        AL.AUDITCATEGORYID, AC.AUDITCATEGORY, AL.DESCRIPTION, AL.RESOLUTION, AL.OCCURRENCE, AL.OCCURRENCEBY, AL.RESOLVED, AL.RESOLVEDBY, AL.STATUS, AL.TYPE, AL.AUDITLOGID
FROM            dbo.AUDITLOG AS AL
INNER JOIN AUDITCATEGORY AS AC ON AC.AUDITCATEGORYID = AL.AUDITCATEGORYID

GO


IF OBJECT_ID ('viewPriceListProducts', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPriceListProducts] 
END

GO

CREATE  VIEW [dbo].[viewPriceListProducts]
AS
SELECT       TOP (100) PERCENT E.CUSTID, E.PRODUCTID, E.PRODUCTDESC, E.CONTAINER, E.VOLUMEUNITS, E.VOLUMEUOM, E.WEIGHTUNITS, E.WEIGHTUOM, E.DESC2

FROM            (SELECT      dbo.PRICELIST.CUSTID, dbo.PRICELIST.PRODUCTID, MAX(EFFECTIVEDATE) AS EFFECTIVEDATE
                          FROM            dbo.PRICELIST
                          WHERE        EFFECTIVEDATE <= GETDATE()
                          GROUP BY dbo.PRICELIST.CUSTID, dbo.PRICELIST.PRODUCTID) A CROSS APPLY
                             (SELECT        TOP 1 PRICELISTID, PL.CUSTID, PL.PRODUCTID, EFFECTIVEDATE, p.PRODUCTDESC, p.CONTAINER, p.VOLUMEUNITS, p.VOLUMEUOM, p.WEIGHTUNITS, p.WEIGHTUOM, p.DESC2
                               FROM            PRICELIST PL INNER JOIN
                                                         dbo.PRODUCT p ON PL.PRODUCTID = p.PRODUCTID
                               WHERE  PL.PRODUCTID = A.PRODUCTID AND PL.EFFECTIVEDATE = A.EFFECTIVEDATE AND PL.CUSTID = A.CUSTID) E
ORDER BY E.PRODUCTDESC

GO



IF OBJECT_ID ('viewWorkOrderItemsScreen', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderItemsScreen] 
END

GO

CREATE VIEW [dbo].[viewWorkOrderItemsScreen]
AS
SELECT     dbo.WORKORDERITEM.WORKORDERITEMNUMBER, dbo.WORKORDERITEM.WORKORDERNUMBER, dbo.WORKORDERITEM.ITEMTYPE, 
                      dbo.WORKORDERITEM.ITEMID, dbo.WORKORDERITEM.ITEMDESCRIPTION, dbo.WORKORDERITEM.PRODUCTID, dbo.WORKORDERITEM.PRODUCTDESC, 
                      dbo.WORKORDERITEM.CONTAINER, dbo.WORKORDERITEM.QTY, dbo.WORKORDERITEM.INVITEMNUMBER, dbo.WORKORDERITEM.ITEMCOMMENTS, 
                      dbo.WORKORDERITEM.LOTNUMBER, dbo.WORKORDERITEM.WAREHOUSELOCATION, 
					  ISNULL(dbo.WORKORDERITEM.BILLABLE,0) AS  BILLABLE,
					  dbo.WORKORDERITEM.UNITCOST, 
                      dbo.WORKORDERITEM.ITEMPRICE, dbo.WORKORDERITEM.ITEMPROFIT, dbo.WORKORDERITEM.UNITORCONTAINER, dbo.WORKORDERITEM.UNITS, 
                      dbo.WORKORDERITEM.UOM,  
                      dbo.WORKORDERITEM.SOURCETYPE, dbo.WORKORDERITEM.SOURCEDOCUMENT, dbo.WORKORDERITEM.WORKORDERITEMSTATUS, 
                      dbo.WORKORDERITEM.CUSTOMERPO, dbo.WORKORDERITEM.SHIPMENTITEMNUMBER, dbo.WORKORDERITEM.INVOICEITEMNUMBER, 
                      dbo.WORKORDERITEM.TOTALVOLUME, dbo.WORKORDERITEM.VOLUMEUOM, dbo.WORKORDERITEM.TOTALWEIGHT, dbo.WORKORDERITEM.WEIGHTUOM, 
                      dbo.WORKORDERITEM.DOTIDNumber, dbo.WORKORDERITEM.HAZMATID, dbo.WORKORDERITEM.HAZMATCLASS, 
                      dbo.WORKORDERITEM.HAZMATPACKAGEGROUP, dbo.WORKORDERITEM.CLASSRATE, dbo.WORKORDERITEM.DOTDESC, dbo.WORKORDERITEM.HAZMATDESC, 
                      dbo.WORKORDERITEM.UNLINE, 
					  ISNULL(dbo.WORKORDERITEM.ISHAZARDOUS,0) AS ISHAZARDOUS, 
					  dbo.WORKORDERITEM.ITEMNOTES, dbo.WORKORDERITEM.CREATEDTIME, 
                      dbo.WORKORDERITEM.CREATEDBY, dbo.WORKORDERITEM.MODIFIEDTIME, dbo.WORKORDERITEM.MODIFIEDBY, dbo.WORKORDERITEM.LD1, 
                      dbo.WORKORDERITEM.LD2, dbo.WORKORDERITEM.LD3, dbo.WORKORDERITEM.CUSTITEMID, dbo.INVITEM.ITEMSTATUS,
					  dbo.WORKORDERITEM.STANDARDUNITCOST, 
					  dbo.WORKORDERITEM.UNITPRICE,
					  dbo.WORKORDERITEM.PRICEUNITS,
						dbo.WORKORDERITEM.PRICEUOM,				
						dbo.WORKORDERITEM.STANDARDCOSTUNITS,
						dbo.WORKORDERITEM.STANDARDCOSTUOM,					
						dbo.WORKORDERITEM.ACTUALCOSTUNITS,
						dbo.WORKORDERITEM.ACTUALCOSTUOM,

	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL

(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END AS EXTPRICE,
	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  

ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END AS EXTCOST,
	CASE WHEN
	ISNULL((CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.ACTUALCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  

ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  END),0)=0 
	THEN
		CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  

ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  END
	ELSE
		CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.ACTUALCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  

ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  END
	END AS ACTUALUNITCOST,

	ISNULL(((CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL

(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END) - (CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL

(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END)),0) AS EXTPROFIT
	

FROM         dbo.WORKORDERITEM LEFT OUTER JOIN
                      dbo.INVITEM ON dbo.WORKORDERITEM.INVITEMNUMBER = dbo.INVITEM.INVITEMNUMBER






GO


IF OBJECT_ID ('viewWorkOrderItemsScreen', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderItemsScreen] 
END

GO

CREATE VIEW [dbo].[viewWorkOrderItemsScreen]
AS
SELECT     dbo.WORKORDERITEM.WORKORDERITEMNUMBER, dbo.WORKORDERITEM.WORKORDERNUMBER, dbo.WORKORDERITEM.ITEMTYPE, 
                      dbo.WORKORDERITEM.ITEMID, dbo.WORKORDERITEM.ITEMDESCRIPTION, dbo.WORKORDERITEM.PRODUCTID, dbo.WORKORDERITEM.PRODUCTDESC, 
                      dbo.WORKORDERITEM.CONTAINER, dbo.WORKORDERITEM.QTY, dbo.WORKORDERITEM.INVITEMNUMBER, dbo.WORKORDERITEM.ITEMCOMMENTS, 
                      dbo.WORKORDERITEM.LOTNUMBER, dbo.WORKORDERITEM.WAREHOUSELOCATION, 
					  ISNULL(dbo.WORKORDERITEM.BILLABLE,0) AS  BILLABLE,
					  dbo.WORKORDERITEM.UNITCOST, 
                      dbo.WORKORDERITEM.ITEMPRICE, dbo.WORKORDERITEM.ITEMPROFIT, dbo.WORKORDERITEM.UNITORCONTAINER, dbo.WORKORDERITEM.UNITS, 
                      dbo.WORKORDERITEM.UOM,  
                      dbo.WORKORDERITEM.SOURCETYPE, dbo.WORKORDERITEM.SOURCEDOCUMENT, dbo.WORKORDERITEM.WORKORDERITEMSTATUS, 
                      dbo.WORKORDERITEM.CUSTOMERPO, dbo.WORKORDERITEM.SHIPMENTITEMNUMBER, dbo.WORKORDERITEM.INVOICEITEMNUMBER, 
                      dbo.WORKORDERITEM.TOTALVOLUME, dbo.WORKORDERITEM.VOLUMEUOM, dbo.WORKORDERITEM.TOTALWEIGHT, dbo.WORKORDERITEM.WEIGHTUOM, 
                      dbo.WORKORDERITEM.DOTIDNumber, dbo.WORKORDERITEM.HAZMATID, dbo.WORKORDERITEM.HAZMATCLASS, 
                      dbo.WORKORDERITEM.HAZMATPACKAGEGROUP, dbo.WORKORDERITEM.CLASSRATE, dbo.WORKORDERITEM.DOTDESC, dbo.WORKORDERITEM.HAZMATDESC, 
                      dbo.WORKORDERITEM.UNLINE, 
					  ISNULL(dbo.WORKORDERITEM.ISHAZARDOUS,0) AS ISHAZARDOUS, 
					  dbo.WORKORDERITEM.ITEMNOTES, dbo.WORKORDERITEM.CREATEDTIME, 
                      dbo.WORKORDERITEM.CREATEDBY, dbo.WORKORDERITEM.MODIFIEDTIME, dbo.WORKORDERITEM.MODIFIEDBY, dbo.WORKORDERITEM.LD1, 
                      dbo.WORKORDERITEM.LD2, dbo.WORKORDERITEM.LD3, dbo.WORKORDERITEM.CUSTITEMID, dbo.INVITEM.ITEMSTATUS,
					  dbo.WORKORDERITEM.STANDARDUNITCOST, 
					  dbo.WORKORDERITEM.UNITPRICE,
					  dbo.WORKORDERITEM.PRICEUNITS,
						dbo.WORKORDERITEM.PRICEUOM,				
						dbo.WORKORDERITEM.STANDARDCOSTUNITS,
						dbo.WORKORDERITEM.STANDARDCOSTUOM,					
						dbo.WORKORDERITEM.ACTUALCOSTUNITS,
						dbo.WORKORDERITEM.ACTUALCOSTUOM,

	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL

(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END AS EXTPRICE,
	CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  

ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END AS EXTCOST,
	
	ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) AS ACTUALUNITCOST,

	ISNULL(((CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE ISNULL

(dbo.WORKORDERITEM.UNITPRICE,0) *  ISNULL(dbo.WORKORDERITEM.QTY,0) END) - (CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL

(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END)),0) AS EXTPROFIT
	

FROM         dbo.WORKORDERITEM LEFT OUTER JOIN
                      dbo.INVITEM ON dbo.WORKORDERITEM.INVITEMNUMBER = dbo.INVITEM.INVITEMNUMBER


					  
GO


--------------------------------14.3 Release ---------------------------------------

GO
IF OBJECT_ID ('viewAltComponent', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAltComponent] 
END


GO

CREATE VIEW [dbo].[viewAltComponent]
AS
SELECT A.COMPONENTID,A.ALTCOMPONENTID,A.RECID,C.COMPONENTDESC,C.VENDORDESC,C.VENDORNAME,C.VENDORITEMID,C.UNITCOST
FROM dbo.ALTCOMPONENT A
INNER JOIN (SELECT C.COMPONENTID,C.COMPONENTDESC,C.VENDORDESC,C.VENDORNAME,C.VENDORITEMID,C.UNITCOST 
			FROM dbo.COMPONENT C) C ON C.COMPONENTID = A.ALTCOMPONENTID



GO


IF OBJECT_ID ('viewKitComponent', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewKitComponent] 
END

GO

CREATE VIEW [dbo].[viewKitComponent]
AS
SELECT        dbo.KIT.KITID, dbo.KitComponent.KitComponentID, dbo.KitComponent.COMPONENTID, dbo.KitComponent.COMPONENTQTY, dbo.COMPONENT.COMPONENTDESC, dbo.COMPONENT.VENDORNAME, dbo.COMPONENT.VENDORITEMID, 
                         dbo.COMPONENT.VENDORDESC, dbo.COMPONENT.UNITCOST, dbo.COMPONENT.QTY
FROM  dbo.KIT 
	INNER JOIN dbo.KitComponent ON dbo.KIT.KITID =  dbo.KitComponent .KITID  INNER JOIN
						 dbo.COMPONENT ON dbo.COMPONENT.COMPONENTID = dbo.KitComponent.COMPONENTID  
						 




GO

IF OBJECT_ID ('viewKitList', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewKitList] 
END

GO

CREATE VIEW [dbo].[viewKitList]
AS
SELECT  dbo.COMPONENT.COMPONENTID, dbo.COMPONENT.COMPONENTDESC, dbo.COMPONENT.VENDORDESC, dbo.KitComponent.COMPONENTQTY, dbo.KitComponent.KITID, dbo.KitComponent.KitComponentID
FROM    dbo.COMPONENT INNER JOIN
            dbo.KitComponent ON dbo.COMPONENT.COMPONENTID = dbo.KitComponent.COMPONENTID

GO

IF OBJECT_ID ('viewOrdersReadyForInvoice', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewOrdersReadyForInvoice] 
END

GO

CREATE VIEW [viewOrdersReadyForInvoice]
AS
SELECT DISTINCT  dbo.viewWorkOrdersStatusOfInvoice.WORKORDERNUMBER, dbo.viewWorkOrdersStatusOfInvoice.CUSTID, dbo.viewWorkOrdersStatusOfInvoice.CUSTNAME, 
                      dbo.viewWorkOrdersStatusOfInvoice.CUSTOMERPO, dbo.viewWorkOrdersStatusOfInvoice.ORDERSTATUS, dbo.viewWorkOrdersStatusOfInvoice.WORKORDERDATE, 
                      dbo.viewWorkOrdersStatusOfInvoice.BILLINGTYPE, dbo.viewWorkOrdersStatusOfInvoice.TRANSPORTTYPE, dbo.viewWorkOrdersStatusOfInvoice.ORDERTYPE, 
                      dbo.[LOAD].LoadStatus, dbo.[LOAD].LoadType, dbo.[LOAD].PlannedDeliveryDate, dbo.[LOAD].ActualShipmentDate, dbo.[LOAD].CarrierProNumber, 
                      dbo.[LOAD].AddToInvoice, dbo.[LOAD].BillCustomer, dbo.LOADBILLING.BilledAmount, dbo.LOADBILLING.BillingDate, dbo.LOADBILLING.InvoiceNumber, 
                      dbo.LOADBILLING.Status, dbo.[LOAD].LoadID AS Expr1
FROM         dbo.viewWorkOrdersStatusOfInvoice LEFT OUTER JOIN
                      dbo.[LOAD] INNER JOIN
                      dbo.LOADITEM ON dbo.[LOAD].LoadID = dbo.LOADITEM.LoadID INNER JOIN
                      dbo.LOADBILLING ON dbo.[LOAD].LoadID = dbo.LOADBILLING.LOADID INNER JOIN
                      dbo.WORKORDERITEM ON dbo.LOADITEM.SourceID = dbo.WORKORDERITEM.WORKORDERITEMNUMBER ON 
                      dbo.viewWorkOrdersStatusOfInvoice.WORKORDERNUMBER = dbo.WORKORDERITEM.WORKORDERNUMBER

GO



/************************* viewRptInventoryProfitAndLossAnalysis *************************/
IF OBJECT_ID ('viewRptInventoryProfitAndLossAnalysis', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptInventoryProfitAndLossAnalysis] 
END

GO

CREATE VIEW [viewRptInventoryProfitAndLossAnalysis]
AS
SELECT     w.WORKORDERNUMBER, w.WORKORDERDATE,w.SUBTOTAL,c.CUSTNAME,
WI.Cost, 
WI.Price, 
WI.Profit, 
ROUND(WI.EXTPRICE,2) AS EXTPRICE,
ROUND(WI.STANDARDCOST,2) AS STANDARDCOST,
ROUND(WI.ACTUALUNITCOST,2) AS ACTUALUNITCOST,
ROUND(WI.STDPROFIT,2) AS STDPROFIT,
ROUND(WI.ACTPROFIT,2) AS ACTPROFIT
FROM dbo.WORKORDER AS w	
	INNER JOIN dbo.CUSTOMER AS c ON w.CUSTID = c.CUSTID
	INNER JOIN (SELECT WORKORDERNUMBER, SUM(b.STANDARDUNITCOST * b.UNITS) AS Cost, 
				SUM(b.EXTPRICE) AS Price, 
				SUM(b.EXTPRICE - (b.STANDARDUNITCOST * b.UNITS)) AS Profit,
				SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE,0) * ISNULL(b.PRICEUNITS,0) * ISNULL(b.QTY,0)  ELSE ISNULL(b.UNITPRICE,0) *  ISNULL(b.QTY,0) END) AS EXTPRICE,

				SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL( b.QTY,0)  END) AS STANDARDCOST,
						
				SUM(CASE WHEN
				ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END),0)=0 
				THEN
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.QTY,0)  END
				ELSE
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END
				END) AS ACTUALUNITCOST,
	
				SUM(ISNULL(((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE,0) * ISNULL(b.PRICEUNITS,0) * ISNULL(b.QTY,0)  ELSE ISNULL(b.UNITPRICE,0) *  ISNULL(b.QTY,0) END) - (CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL( b.QTY,0)  END)),0)) AS STDPROFIT,
	
				SUM(ISNULL((
				(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE,0) * ISNULL(b.PRICEUNITS,0) * ISNULL(b.QTY,0)  ELSE ISNULL(b.UNITPRICE,0) *  ISNULL(b.QTY,0) END)
				-(		
				CASE WHEN
				ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END),0)=0 
				THEN
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.STANDARDCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.STANDARDUNITCOST,0) * ISNULL(b.QTY,0)  END
				ELSE
					CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.ACTUALCOSTUNITS,0) * ISNULL(b.QTY,0)  ELSE  ISNULL(b.ACTUALUNITCOST,0) * ISNULL(b.QTY,0)  END
				END	
				)),0)) AS ACTPROFIT		
				FROM         dbo.WORKORDERITEM AS b
				WHERE b.BILLABLE = 1
				GROUP BY WORKORDERNUMBER
				) WI ON WI.WORKORDERNUMBER = w.WORKORDERNUMBER
 WHERE w.ORDERSTATUS NOT IN ('PENDING', 'CANCELLED')

GO


---------------------------- 14.2 After Shaun's changes ----------------------------------------------------
/************************* viewRptInvoice2 *************************/
IF OBJECT_ID ('viewRptInvoice2', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptInvoice2] 
END

GO

CREATE VIEW [viewRptInvoice2]
AS
SELECT     dbo.INVOICE.INVOICENUMBER, dbo.INVOICE.INVOICEDATE, dbo.INVOICE.SHIPMENTNUMBER, dbo.INVOICE.SHIPMENTDATE, dbo.INVOICE.CUSTID, 
                      dbo.INVOICE.BILLADDRESS1, dbo.INVOICE.BILLADDRESS2, dbo.INVOICE.BILLCITY, dbo.INVOICE.BILLSTATEPROV, dbo.INVOICE.BILLPOSTALCODE, 
                      dbo.INVOICE.BILLCOUNTRY, dbo.INVOICE.BILLPHONE, dbo.INVOICE.BILLFAX, dbo.INVOICE.BILLCONTACT, dbo.INVOICE.SHIPADDRESS1, 
                      dbo.INVOICE.SHIPADDRESS2, dbo.INVOICE.SHIPCITY, dbo.INVOICE.SHIPSTATEPROV, dbo.INVOICE.SHIPPOSTALCODE, dbo.INVOICE.SHIPCOUNTRY, 
                      dbo.INVOICE.SHIPCONTACT, dbo.INVOICE.FREIGHTCARRIER, dbo.INVOICE.FOB, dbo.INVOICE.CUSTOMERPO, dbo.INVOICE.ORDERTERMS, 
                      dbo.INVOICE.DELIVERYDATE, dbo.INVOICE.SHIPPEDDATE, dbo.INVOICE.SUBTOTAL, dbo.INVOICE.SALESTAX, dbo.INVOICE.TOTAL, dbo.INVOICE.INVOICESTATUS, 
                      dbo.INVOICE.INVNUMVIEW, dbo.INVOICEITEM.PRODUCTID, dbo.INVOICEITEM.PRODUCTDESC, SUM(dbo.INVOICEITEM.QUANTITY) AS INVOICEQTY, 
                      dbo.INVOICEITEM.UNITORCONTAINER, dbo.INVOICEITEM.CONTAINER, dbo.INVOICEITEM.UOM, dbo.INVOICEITEM.ITEMPRICE, SUM(dbo.INVOICEITEM.EXTPRICE) 
                      AS EXTPRICETOTAL, dbo.INVOICEITEM.TAXABLE, dbo.CUSTOMER.CUSTNAME, dbo.INVOICEITEM.ITEMID, dbo.INVOICEITEM.ITEMDESCRIPTION, 
                      dbo.INVOICEITEM.ITEMTYPE, dbo.LIST_ITEMTYPE.RecID AS ITEMSORT, dbo.INVOICEITEM.PRICEUNITS, dbo.INVOICEITEM.PRICEUOM, 
                      dbo.INVOICEITEM.UNITPRICE
FROM         dbo.INVOICEITEM INNER JOIN
                      dbo.INVOICE ON dbo.INVOICEITEM.INVOICENUMBER = dbo.INVOICE.INVOICENUMBER INNER JOIN
                      dbo.CUSTOMER ON dbo.INVOICE.CUSTID = dbo.CUSTOMER.CUSTID INNER JOIN
                      dbo.LIST_ITEMTYPE ON dbo.INVOICEITEM.ITEMTYPE = dbo.LIST_ITEMTYPE.ITEMTYPE
GROUP BY dbo.INVOICE.INVOICENUMBER, dbo.INVOICE.INVOICEDATE, dbo.INVOICE.SHIPMENTNUMBER, dbo.INVOICE.SHIPMENTDATE, dbo.INVOICE.CUSTID, 
                      dbo.INVOICE.BILLADDRESS1, dbo.INVOICE.BILLADDRESS2, dbo.INVOICE.BILLCITY, dbo.INVOICE.BILLSTATEPROV, dbo.INVOICE.BILLPOSTALCODE, 
                      dbo.INVOICE.BILLCOUNTRY, dbo.INVOICE.BILLPHONE, dbo.INVOICE.BILLFAX, dbo.INVOICE.BILLCONTACT, dbo.INVOICE.SHIPADDRESS1, 
                      dbo.INVOICE.SHIPADDRESS2, dbo.INVOICE.SHIPCITY, dbo.INVOICE.SHIPSTATEPROV, dbo.INVOICE.SHIPPOSTALCODE, dbo.INVOICE.SHIPCOUNTRY, 
                      dbo.INVOICE.SHIPCONTACT, dbo.INVOICE.FREIGHTCARRIER, dbo.INVOICE.FOB, dbo.INVOICE.CUSTOMERPO, dbo.INVOICE.ORDERTERMS, 
                      dbo.INVOICE.DELIVERYDATE, dbo.INVOICE.SHIPPEDDATE, dbo.INVOICE.SUBTOTAL, dbo.INVOICE.SALESTAX, dbo.INVOICE.TOTAL, dbo.INVOICE.INVOICESTATUS, 
                      dbo.INVOICE.INVNUMVIEW, dbo.INVOICEITEM.PRODUCTID, dbo.INVOICEITEM.PRODUCTDESC, dbo.INVOICEITEM.UNITORCONTAINER, dbo.INVOICEITEM.CONTAINER, 
                      dbo.INVOICEITEM.UOM, dbo.INVOICEITEM.ITEMPRICE, dbo.INVOICEITEM.TAXABLE, dbo.CUSTOMER.CUSTNAME, dbo.INVOICEITEM.ITEMID, 
                      dbo.INVOICEITEM.ITEMDESCRIPTION, dbo.INVOICEITEM.ITEMTYPE, dbo.LIST_ITEMTYPE.RecID, dbo.INVOICEITEM.PRICEUNITS, dbo.INVOICEITEM.PRICEUOM, 
                      dbo.INVOICEITEM.UNITPRICE

GO


/************************* viewRptWorkOrder *************************/
IF OBJECT_ID ('viewRptWorkOrder', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptWorkOrder] 
END

GO


--------------------------------14.4 Release ---------------------------------------

/************************* viewAuditForm *************************/
IF OBJECT_ID ('viewAuditForm', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAuditForm] 
END
GO

CREATE VIEW [viewRptWorkOrder]
AS
SELECT     dbo.WORKORDERITEM.WORKORDERITEMNUMBER, dbo.WORKORDERITEM.WORKORDERNUMBER, dbo.WORKORDERITEM.PRODUCTID, 
                      dbo.WORKORDERITEM.QTY, dbo.WORKORDERITEM.INVITEMNUMBER, dbo.WORKORDERITEM.ITEMCOMMENTS, dbo.WORKORDERITEM.LOTNUMBER, 
                      dbo.WORKORDERITEM.WAREHOUSELOCATION, dbo.WORKORDER.CUSTID, dbo.CUSTOMER.CUSTNAME, dbo.WORKORDER.SHIPADDRESS1, 
                      dbo.WORKORDER.SHIPADDRESS2, dbo.WORKORDER.SHIPCITY, dbo.WORKORDER.SHIPSTATEPROV, dbo.WORKORDER.SHIPPOSTALCODE, 
                      dbo.WORKORDER.SHIPCOUNTRY, dbo.WORKORDER.SHIPCONTACT, dbo.WORKORDER.FREIGHTCARRIER, dbo.WORKORDER.FOB, 
                      dbo.WORKORDER.CUSTOMERPO, dbo.WORKORDER.ORDERTERMS, dbo.WORKORDER.DELIVERYDATE, dbo.WORKORDER.PLANNEDSHIPDATE, 
                      dbo.WORKORDER.HOWRECEIVED, dbo.WORKORDER.ORDERSTATUS, dbo.WORKORDER.ORDERNOTES, dbo.WORKORDER.WORKORDERDATE, 
                      dbo.WORKORDER.PREPAREDBY, dbo.WORKORDER.SUPPLIERCOMPANY, dbo.PRODUCT.PRODUCTDESC, dbo.PRODUCT.STDGALLONS, 
                      dbo.PRODUCT.STDWEIGHT, dbo.PRODUCT.CONTAINER, 
                      (dbo.PRODUCT.STDWEIGHT + CASE WHEN dbo.CONTAINER.TareWeight > 0 THEN dbo.CONTAINER.TareWeight ELSE 0 END) 
                      * dbo.WORKORDERITEM.QTY AS GROSSWEIGHT, dbo.WORKORDERITEM.SOURCETYPE, dbo.WORKORDERITEM.SOURCEDOCUMENT, 
                      dbo.WORKORDER.CREATEDBY, dbo.WORKORDER.PRODFULFILLMENTNOTES, dbo.WORKORDER.TRANSPORTTYPE, dbo.WORKORDER.ORDERTYPE, 
                      dbo.WORKORDERITEM.CUSTITEMID, dbo.WORKORDERITEM.PRICEUNITS, dbo.WORKORDERITEM.PRICEUOM, dbo.WORKORDERITEM.UNITPRICE, 
                      dbo.WORKORDERITEM.STANDARDCOSTUNITS, dbo.WORKORDERITEM.STANDARDCOSTUOM, dbo.WORKORDERITEM.STANDARDUNITCOST, 
                      dbo.WORKORDERITEM.ACTUALCOSTUNITS, dbo.WORKORDERITEM.ACTUALCOSTUOM, dbo.WORKORDERITEM.ACTUALUNITCOST
FROM         dbo.CUSTOMER INNER JOIN
                      dbo.WORKORDER ON dbo.CUSTOMER.CUSTID = dbo.WORKORDER.CUSTID INNER JOIN
                      dbo.WORKORDERITEM INNER JOIN
                      dbo.PRODUCT ON dbo.WORKORDERITEM.PRODUCTID = dbo.PRODUCT.PRODUCTID ON 
                      dbo.WORKORDER.WORKORDERNUMBER = dbo.WORKORDERITEM.WORKORDERNUMBER INNER JOIN
                      dbo.CONTAINER ON dbo.PRODUCT.CONTAINER = dbo.CONTAINER.Container
GO

/************************* viewAuditCategory *************************/
IF OBJECT_ID ('viewAuditCategory', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAuditCategory] 
END
GO
CREATE VIEW viewAuditCategory
AS
SELECT	AUDITCATEGORYID, AUDITCATEGORY, AUDITFORMNAME
FROM	AUDITCATEGORY
GO 

/************************* viewAuditPermissions *************************/
IF OBJECT_ID ('viewAuditPermissions', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAuditPermissions] 
END
GO
CREATE VIEW viewAuditPermissions
AS
SELECT	AUDITPERMISSIONS.AUDITPERMISSIONSID, APPUSER.USERLOGIN, AUDITCATEGORY.AUDITCATEGORY
FROM	AUDITPERMISSIONS 
INNER JOIN	APPUSER ON APPUSER.APPUSERID = AUDITPERMISSIONS.USERID
INNER JOIN	AUDITCATEGORY ON AUDITCATEGORY.AUDITCATEGORYID = AUDITPERMISSIONS.AUDITCATEGORYID
GO 


/************************* viewAuditLog *************************/
IF OBJECT_ID ('viewAuditLog', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAuditLog] 
END
GO
 
CREATE VIEW [dbo].[viewAuditLog]
AS
SELECT        DISTINCT dbo.AUDITCATEGORY.AUDITCATEGORY, dbo.AUDITLOG.DESCRIPTION, dbo.AUDITLOG.RESOLUTION, dbo.AUDITLOG.OCCURRENCE, dbo.AUDITLOG.OCCURRENCEBY, dbo.AUDITLOG.RESOLVED, 
                         dbo.AUDITLOG.RESOLVEDBY, dbo.AUDITLOG.STATUS, dbo.AUDITLOG.TYPE, dbo.AUDITLOG.AUDITLOGID, dbo.AUDITLOG.MASTERRECORDID, dbo.AUDITLOG.AUDITREASON, dbo.AUDITPERMISSIONS.USERID                         
FROM            dbo.AUDITCATEGORY INNER JOIN
                         dbo.AUDITLOG ON dbo.AUDITCATEGORY.AUDITCATEGORYID = dbo.AUDITLOG.AUDITCATEGORYID INNER JOIN
                         dbo.AUDITPERMISSIONS ON dbo.AUDITCATEGORY.AUDITCATEGORYID = dbo.AUDITPERMISSIONS.AUDITCATEGORYID

GO

/************************* viewAppuser *************************/

IF OBJECT_ID ('viewAppuser', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAppuser] 
END
GO
CREATE VIEW [dbo].[viewAppuser]
AS
SELECT	TOP (100) APPUSERID, USERLOGIN
FROM	dbo.APPUSER
ORDER BY USERSTATUS, USERLOGIN
GO


IF OBJECT_ID ('viewAuditLogEmailRecipients', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAuditLogEmailRecipients] 
END
GO
CREATE VIEW [dbo].[viewAuditLogEmailRecipients]
AS
SELECT	DISTINCT TOP (100)  APPUSER.APPUSERID, APPUSER.USERLOGIN, AUDITCATEGORY.AUDITCATEGORY, AUDITCATEGORY.AUDITCATEGORYID
FROM	dbo.APPUSER
INNER JOIN AUDITPERMISSIONS ON AUDITPERMISSIONS.USERID = APPUSER.APPUSERID
INNER JOIN AUDITCATEGORY ON AUDITCATEGORY.AUDITCATEGORYID = AUDITPERMISSIONS.AUDITCATEGORYID
WHERE USERSTATUS = 'ACTIVE'
ORDER BY USERLOGIN
GO


--------------------------------Changes after Code Review – 14.4 Release ---------------------------------------

/****** Object:  View [dbo].[viewRptInventoryProfitAndLossAnalysis]    Script Date: 09/10/2014 11:43:10 ******/
SET ANSI_NULLS ON
GO

IF OBJECT_ID ('viewRptInventoryProfitAndLossAnalysis', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptInventoryProfitAndLossAnalysis] 
END
GO
CREATE VIEW [dbo].[viewRptInventoryProfitAndLossAnalysis]
AS
SELECT     w.WORKORDERNUMBER, w.WORKORDERDATE, w.SUBTOTAL, c.CUSTNAME, WI.Cost, WI.Price, WI.Profit, WI.EXTPRICE, WI.STANDARDCOST, WI.ACTUALUNITCOST, 
                      WI.STDPROFIT, WI.ACTPROFIT
FROM         dbo.WORKORDER AS w INNER JOIN
                      dbo.CUSTOMER AS c ON w.CUSTID = c.CUSTID INNER JOIN
                          (SELECT     WORKORDERNUMBER, SUM(STANDARDUNITCOST * UNITS) AS Cost, SUM(EXTPRICE) AS Price, SUM(EXTPRICE - STANDARDUNITCOST * UNITS) 
                                                   AS Profit, SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE, 0) * ISNULL(b.PRICEUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.UNITPRICE, 0) * ISNULL(b.QTY, 0) END) AS EXTPRICE, 
                                                   SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST, 0) * ISNULL(b.STANDARDCOSTUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.STANDARDUNITCOST, 0) * ISNULL(b.QTY, 0) END) AS STANDARDCOST, 
                                                   SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST, 0) * ISNULL(b.ACTUALCOSTUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.ACTUALUNITCOST, 0) * ISNULL(b.QTY, 0) END) AS ACTUALUNITCOST, 
                                                   SUM(ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE, 0) * ISNULL(b.PRICEUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.UNITPRICE, 0) * ISNULL(b.QTY, 0) END) - (CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST, 0) 
                                                   * ISNULL(b.STANDARDCOSTUNITS, 0) * ISNULL(b.QTY, 0) ELSE ISNULL(b.STANDARDUNITCOST, 0) * ISNULL(b.QTY, 0) END), 0)) AS STDPROFIT, 
                                                   SUM(ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE, 0) * ISNULL(b.PRICEUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.UNITPRICE, 0) * ISNULL(b.QTY, 0) END) - (CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST, 0) 
                                                   * ISNULL(b.ACTUALCOSTUNITS, 0) * ISNULL(b.QTY, 0) ELSE ISNULL(b.ACTUALUNITCOST, 0) * ISNULL(b.QTY, 0) END), 0)) AS ACTPROFIT
                            FROM          dbo.WORKORDERITEM AS b
                            WHERE      (BILLABLE = 1)
                            GROUP BY WORKORDERNUMBER) AS WI ON WI.WORKORDERNUMBER = w.WORKORDERNUMBER
WHERE     (w.ORDERSTATUS NOT IN ('PENDING', 'CANCELLED')) AND (w.WORKORDERDATE BETWEEN '09/01/2014' AND '09/05/2014')

GO

--------------14.50 Release ----------------
/************************* viewWorkOrderProductAPIS *************************/

IF OBJECT_ID ('viewWorkOrderProductAPIS', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderProductAPIS] 
END
GO
CREATE VIEW [dbo].[viewWorkOrderProductAPIS]
AS
SELECT     dbo.WORKORDER.WORKORDERNUMBER, dbo.CUSTOMER.CUSTID, dbo.CUSTOMER.CUSTNAME, SUM(dbo.WORKORDERITEM.QTY) AS QTY, dbo.PRODUCT.CONTAINER, 
                      dbo.PRODUCT.PRODUCTID, dbo.PRODUCT.PRODUCTDESC, '' AS WORKORDERNUMBERNO, '' AS CUSNAME, '' AS PRODUCTDESCRIPTION
FROM         dbo.CUSTOMER INNER JOIN
                      dbo.WORKORDER ON dbo.CUSTOMER.CUSTID = dbo.WORKORDER.CUSTID INNER JOIN
                      dbo.WORKORDERITEM ON dbo.WORKORDERITEM.WORKORDERNUMBER = dbo.WORKORDER.WORKORDERNUMBER INNER JOIN
                      dbo.PRODUCT ON dbo.PRODUCT.PRODUCTID = dbo.WORKORDERITEM.PRODUCTID
GROUP BY dbo.WORKORDER.WORKORDERNUMBER, dbo.CUSTOMER.CUSTID, dbo.CUSTOMER.CUSTNAME, dbo.PRODUCT.CONTAINER, dbo.PRODUCT.PRODUCTID, dbo.PRODUCT.PRODUCTDESC

GO

IF OBJECT_ID ('viewRptWorkOrderFulfillmentPlan', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptWorkOrderFulfillmentPlan] 
END
GO
CREATE VIEW [dbo].[viewRptWorkOrderFulfillmentPlan]
AS
SELECT W.WORKORDERNUMBER,	 
		CONVERT(VARCHAR,W.WORKORDERNUMBER) + ' - ' + 
		CONVERT(VARCHAR,W.WORKORDERDATE,101) + 
		CASE WHEN COALESCE(W.ORDERTYPE,'') = '' THEN '' ELSE ' - ' END +
		COALESCE(W.ORDERTYPE,'') + 
		CASE WHEN COALESCE(W.TRANSPORTTYPE,'') = '' THEN '' ELSE ' - ' END + 
		COALESCE(W.TRANSPORTTYPE,'') AS WORKORDERDATE,	
	CONVERT(VARCHAR,C.CUSTID)  + ' - ' + C.CUSTNAME + ', ' + W.SHIPCITY + ', ' + W.SHIPSTATEPROV AS CUSTOMER,	
	W.PLANNEDSHIPDATE,
	W.DELIVERYDATE
FROM WORKORDER W	
	INNER JOIN CUSTOMER C ON C.CUSTID = W.CUSTID
	
GO
	
/************************* viewProductFulfillment *************************/

IF OBJECT_ID ('viewProductFulfillment', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewProductFulfillment] 
END
GO
CREATE VIEW [dbo].[viewProductFulfillment]
AS
SELECT     dbo.LIST_FULFILLMENTTYPE.FULFILLMENTTYPE, dbo.PRODUCTFULFILLMENTPLAN.PRIORITY, dbo.PRODUCTFULFILLMENTPLAN.ASSOCIATEDPRODUCTID, 
                      dbo.PRODUCT.PRODUCTDESC AS ASSOCIATEDPRODUCT, dbo.PRODUCTFULFILLMENTPLAN.FULFILLMENTPLANID, dbo.PRODUCTFULFILLMENTPLAN.PRODUCTID
FROM         dbo.PRODUCTFULFILLMENTPLAN INNER JOIN
                      dbo.LIST_FULFILLMENTTYPE ON dbo.PRODUCTFULFILLMENTPLAN.FULFILLMENTTYPEID = dbo.LIST_FULFILLMENTTYPE.FULFILLMENTTYPEID LEFT OUTER JOIN
                      dbo.PRODUCT ON dbo.PRODUCTFULFILLMENTPLAN.ASSOCIATEDPRODUCTID = dbo.PRODUCT.PRODUCTID
GO

/************************* viewMaterialProductInfo *************************/

IF OBJECT_ID ('viewMaterialProductInfo', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewMaterialProductInfo] 
END
GO
CREATE VIEW [dbo].[viewMaterialProductInfo]
AS
SELECT     dbo.MATERIALPRODUCT.MATERIALID, dbo.MATERIALPRODUCT.PRODUCTID, dbo.PRODUCT.PRODUCTDESC, dbo.PRODUCT.CONTAINER, dbo.PRODUCT.UNITS, dbo.PRODUCT.UOM, 
                      dbo.MATERIALPRODUCT.PRIORITY, dbo.PRODUCT.DESC2, dbo.MATERIALPRODUCT.MPID, dbo.MATERIALPRODUCT.MPNOTE
FROM         dbo.MATERIALPRODUCT INNER JOIN
                      dbo.PRODUCT ON dbo.MATERIALPRODUCT.PRODUCTID = dbo.PRODUCT.PRODUCTID
GO

IF OBJECT_ID ('viewProdcutionOrder2', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewProdcutionOrder2] 
END
GO

CREATE VIEW [dbo].[viewProdcutionOrder2]
AS
SELECT DISTINCT PRCHITEM.MATERIALID, PRCHITEM.QTY, PRCHITEM.UOM, PRCHITEM.PRODORDERNUM, WI.WORKORDERNUMBER, 
	ISNULL(C.CUSTNAME,'Americo Chemicals') AS CUSTNAME, 
	PO.NEEDEDBY
FROM         dbo.PRODORDER AS PO INNER JOIN
                      dbo.PRODITEM AS PRCHITEM ON PRCHITEM.PRODORDERNUM = PO.PRODORDERNUM LEFT OUTER JOIN
                      dbo.WORKORDERITEM AS WI ON WI.SOURCEDOCUMENT = PO.PRODORDERNUM LEFT OUTER JOIN
                      dbo.WORKORDER AS WO ON WO.WORKORDERNUMBER = WI.WORKORDERNUMBER LEFT OUTER JOIN
                      dbo.CUSTOMER AS C ON C.CUSTID = PO.CUSTID
WHERE PRCHITEM.ISCOMPLETE = 0

GO

IF OBJECT_ID ('viewPurchaseProductsList', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPurchaseProductsList] 
END
GO


CREATE VIEW [dbo].[viewPurchaseProductsList]
AS
SELECT  M.MATERIALID,
		MP.PRODUCTID,
		P.PRODUCTDESC,		
		P.UOM,
		P.UNITS,
		P.CONTAINER, 
		MP.PRIORITY
FROM MATERIAL M
INNER JOIN MATERIALPRODUCT MP ON MP.MATERIALID = M.MATERIALID
INNER JOIN PRODUCT P ON P.PRODUCTID = MP.PRODUCTID
GO


IF OBJECT_ID ('viewMaterialProductAvailableInventoryItems', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewMaterialProductAvailableInventoryItems] 
END
GO


CREATE VIEW [dbo].[viewMaterialProductAvailableInventoryItems]
AS
SELECT     dbo.MATERIALPRODUCT.MATERIALID, dbo.MATERIALPRODUCT.PRODUCTID, dbo.PRODUCT.PRODUCTDESC, dbo.PRODUCT.CONTAINER, dbo.INVITEM.RECEIVEDDATE, dbo.INVITEM.LOTNUMBER, 
                      dbo.INVITEM.WAREHOUSELOCATION, dbo.INVITEM.ITEMSTATUS, dbo.INVITEM.INVENTORYCLASS, dbo.PRODUCT.UNITS, dbo.PRODUCT.UOM, dbo.INVITEM.INVITEMNUMBER
FROM         dbo.MATERIALPRODUCT INNER JOIN
                      dbo.PRODUCT ON dbo.MATERIALPRODUCT.PRODUCTID = dbo.PRODUCT.PRODUCTID AND ISNULL(dbo.MATERIALPRODUCT.PRIORITY, 0) <> 0 INNER JOIN
                      dbo.INVITEM ON dbo.MATERIALPRODUCT.PRODUCTID = dbo.INVITEM.PRODUCTID AND dbo.INVITEM.INVENTORYCLASS = 1 AND dbo.INVITEM.ALLOCATEDDOCUMENT IS NULL
							AND dbo.INVITEM.ALLOCATEDType IS NULL
WHERE     (dbo.INVITEM.ITEMSTATUS IN ('PENDING', 'TESTING', 'AVAILABLE'))
GO
 
	
--------------14.504 Release ----------------

IF OBJECT_ID ('viewRptPurchaseOrders2', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptPurchaseOrders2] 
END
GO

CREATE VIEW [dbo].[viewRptPurchaseOrders2]
AS

SELECT P.[PURCHASENUMBER] AS PONUMBER
      ,P.[VENDORID]
      ,P.[PURCHASEDATE] AS PODATE
      ,P.[PURCHASETYPE] AS POTYPE
      ,P.[TERMS] AS POTERMS
      ,P.[PURCHASESTATUS] AS POSTATUS
      ,P.[CUSTOMERPO] AS CHANGEABLEPONUMBER
      ,P.[SHIPNAME]
      ,P.[SHIPADDRESS1]
      ,P.[SHIPADDRESS2]
      ,P.[SHIPCITY]
      ,P.[SHIPSTATE]
      ,P.[SHIPZIP]
      ,P.[SHIPCONTACT]
      ,P.[SHIPPHONE]
      ,P.[SUBTOTAL] AS POSUBTOTAL
      ,P.[SALESTAX] AS POSALESTAX
      ,P.[FREIGHTIN] AS POFREIGHTIN
      ,P.[TOTAL] AS POTOTAL
      ,P.[INSTRUCTIONS]
	  ,PRCHITEM.ITEMID AS PRODUCTID
	  ,PRCHITEM.ITEMDESCRIPTION AS PRODUCTDESC
	  ,PRCHITEM.QTY AS QTYORDERED
	  ,PRCHITEM.UNITCOST
	  ,CASE WHEN PRCHITEM.UNITORCONTAINER = 'C' 
	   THEN ISNULL(PRCHITEM.UNITCOST,0) * ISNULL(PRCHITEM.UNITSINCONTAINER,0) * ISNULL(PRCHITEM.QTY,0)
	   ELSE ISNULL(PRCHITEM.UNITCOST,0) * ISNULL(PRCHITEM.QTY,0) END AS EXTPRICE
	  ,PRCHITEM.UOM
	  ,PRCHITEM.CONTAINER
	  ,PRCHITEM.UNITORCONTAINER
	  ,PRCHITEM.VENDORITEMNUMBER
	  ,CASE WHEN COALESCE(PRCHITEM.UNITORCONTAINER,'') = 'U' THEN PRCHITEM.QTY ELSE NULL END AS UNITS	  
	  ,V.VENDORNAME
	  ,V.VENDORADDRESS1 
	  ,V.VENDORADDRESS2 
	  ,V.VENDORCITY 
	  ,V.VENDORSTATE 
	  ,V.VENDORZIP 
	  ,V.VENDORPHONE 
	  ,V.VENDORFAX 
	  ,V.VENDORCONTACT 
	  ,V.VENDOREMAIL 
	  ,V.VENDORURL 
	  ,V.VENDORACCTNUMBER 
	  ,V.TERMS 
	  ,S.CompanyName 
	  ,S.CompanyAddress
	  ,S.CompanyCity + ', ' + S.CompanyState + '  ' + S.CompanyZipcode AS CSZ
	  ,P.[EXPECTEDINDATE] , S.COAText, P.SHIPCITY + ', ' + P.SHIPSTATE + '  ' + P.SHIPZIP AS SHIPCSZ
	  ,V.VENDORCITY + ', ' + V.VENDORSTATE + '  ' + V.VENDORZIP AS VENDORCSZ 
  FROM PURCHASE P
  INNER JOIN 
  (SELECT ITEMID,
		ITEMDESCRIPTION,
		SUM(QTY) AS QTY,
		UNITCOST,
		UNITORCONTAINER,
		UNITSINCONTAINER,
		UOM,
		CONTAINER,
		PURCHASENUMBER,
		VENDORITEMNUMBER
		FROM  PURCHASEITEM
		GROUP BY ITEMID,
			ITEMDESCRIPTION,
			CONTAINER,
			PURCHASENUMBER,
			UNITCOST,
			UNITORCONTAINER,
			UNITSINCONTAINER,
			UOM,
			VENDORITEMNUMBER) PRCHITEM ON PRCHITEM.PURCHASENUMBER = P.PURCHASENUMBER
  LEFT JOIN VENDOR V ON V.VENDORID = P.VENDORID
  CROSS JOIN dbo.SYSPARAMETERS S

GO

IF OBJECT_ID ('viewRptDirectPurchaseOrders2', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptDirectPurchaseOrders2] 
END
GO

CREATE VIEW [dbo].[viewRptDirectPurchaseOrders2]
AS

SELECT P.[PURCHASENUMBER] AS PONUMBER
      ,P.[VENDORID]
      ,P.[PURCHASEDATE] AS PODATE
      ,P.[PURCHASETYPE] AS POTYPE
      ,P.[TERMS] AS POTERMS
      ,P.[PURCHASESTATUS] AS POSTATUS
      ,P.[CUSTOMERPO] AS CHANGEABLEPONUMBER
      ,P.[SHIPNAME]
      ,P.[SHIPADDRESS1]
      ,P.[SHIPADDRESS2]
      ,P.[SHIPCITY]
      ,P.[SHIPSTATE]
      ,P.[SHIPZIP]
      ,P.[SHIPCONTACT]
      ,P.[SHIPPHONE]
      ,P.[SUBTOTAL] AS POSUBTOTAL
      ,P.[SALESTAX] AS POSALESTAX
      ,P.[FREIGHTIN] AS POFREIGHTIN
      ,P.[TOTAL] AS POTOTAL
      ,P.[INSTRUCTIONS]
	  ,PRCHITEM.ITEMID AS PRODUCTID
	  ,PRCHITEM.ITEMDESCRIPTION AS PRODUCTDESC
	  ,PRCHITEM.QTY AS QTYORDERED
	  ,PRCHITEM.UNITCOST
	  ,CASE WHEN PRCHITEM.UNITORCONTAINER = 'C' 
	   THEN ISNULL(PRCHITEM.UNITCOST,0) * ISNULL(PRCHITEM.UNITSINCONTAINER,0) * ISNULL(PRCHITEM.QTY,0)
	   ELSE ISNULL(PRCHITEM.UNITCOST,0) * ISNULL(PRCHITEM.QTY,0) END AS EXTPRICE
	  ,PRCHITEM.UOM
	  ,PRCHITEM.CONTAINER
	  ,PRCHITEM.UNITORCONTAINER
	  ,CASE WHEN COALESCE(PRCHITEM.UNITORCONTAINER,'') = 'U' THEN PRCHITEM.QTY ELSE NULL END AS UNITS	  
	  ,V.VENDORNAME
	  ,V.VENDORADDRESS1 
	  ,V.VENDORADDRESS2 
	  ,V.VENDORCITY 
	  ,V.VENDORSTATE 
	  ,V.VENDORZIP 
	  ,V.VENDORPHONE 
	  ,V.VENDORFAX 
	  ,V.VENDORCONTACT 
	  ,V.VENDOREMAIL 
	  ,V.VENDORURL 
	  ,V.VENDORACCTNUMBER 
	  ,V.TERMS 
	  ,S.CompanyName 
	  ,S.CompanyAddress
	  ,S.CompanyCity + ', ' + S.CompanyState + '  ' + S.CompanyZipcode AS CSZ
	  ,P.[EXPECTEDINDATE] , S.COAText, P.SHIPCITY + ', ' + P.SHIPSTATE + '  ' + P.SHIPZIP AS SHIPCSZ
	  ,V.VENDORCITY + ', ' + V.VENDORSTATE + '  ' + V.VENDORZIP AS VENDORCSZ 
	  ,PRCHITEM.CUSTOMERPO AS ITEMCUSTOMERPO
  FROM PURCHASE P
  INNER JOIN 
  (SELECT ITEMID,
		ITEMDESCRIPTION,
		SUM(QTY) AS QTY,
		UNITCOST,
		UNITORCONTAINER,
		UNITSINCONTAINER,
		UOM,
		CONTAINER,
		PURCHASENUMBER,
		CUSTOMERPO
		FROM  PURCHASEITEM
		GROUP BY ITEMID,
			ITEMDESCRIPTION,
			CONTAINER,
			PURCHASENUMBER,
			CUSTOMERPO,
			UNITCOST,
			UNITORCONTAINER,
			UNITSINCONTAINER,
			UOM) PRCHITEM ON PRCHITEM.PURCHASENUMBER = P.PURCHASENUMBER
  LEFT JOIN VENDOR V ON V.VENDORID = P.VENDORID
  CROSS JOIN dbo.SYSPARAMETERS S

GO

IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[viewINVITEMAvailableDate]'))
	DROP VIEW [dbo].[viewINVITEMAvailableDate]
GO

CREATE VIEW [dbo].[viewINVITEMAvailableDate]
AS
SELECT INVITEM.INVITEMNUMBER,
	CASE 
		WHEN 
			INVITEM.ITEMSTATUS = 'ALLOCATED' OR INVITEM.ITEMSTATUS ='TESTING' OR INVITEM.ITEMSTATUS ='FORRLBL'
		THEN 
			CASE INVITEM.ALLOCATEDTYPE
				WHEN 'WORKORDER'
				THEN WORKORDER.PLANNEDSHIPDATE
				WHEN 'RELABEL'
				THEN RELABELORDER.NEEDEDBY
			END
		WHEN 
			INVITEM.ITEMSTATUS ='PENDING'
		THEN 
			PURCHASEITEM.EXPECTEDINDATE
		WHEN 
			INVITEM.ITEMSTATUS = 'INPROD'
		THEN 
			PRODORDER.ESTIMATEDCOMPLETIONDATE
	END AS AvailableDate,
	CASE
		WHEN
			INVITEM.SOURCETYPE = 'PRCH'
		THEN
			PURCHASEITEM.PURCHASEITEMSTATUS
		WHEN
			INVITEM.SOURCETYPE = 'PORD'
		THEN
			PRODORDER.ORDERSTATUS
	END AS SOURCESTATUS
FROM dbo.INVITEM
LEFT OUTER JOIN dbo.WORKORDERITEM
	ON WORKORDERITEM.INVITEMNUMBER = INVITEM.INVITEMNUMBER
		AND WORKORDERITEM.SOURCETYPE = 'INV'
LEFT OUTER JOIN dbo.RELABELORDER
	ON RELABELORDER.RELABELORDERNUMBER = INVITEM.ALLOCATEDDOCUMENT
		AND INVITEM.ALLOCATEDTYPE = 'RELABEL'
LEFT OUTER JOIN dbo.WORKORDER
	ON WORKORDER.WORKORDERNUMBER = WORKORDERITEM.WORKORDERNUMBER
LEFT OUTER JOIN dbo.PURCHASEITEM
	ON INVITEM.SOURCEDOCUMENT = dbo.PURCHASEITEM.PURCHASEITEMID
		AND INVITEM.SOURCETYPE = 'PRCH'
LEFT OUTER JOIN dbo.PRODORDER
	ON INVITEM.SOURCEDOCUMENT = dbo.PRODORDER.PRODORDERNUM
		AND INVITEM.SOURCETYPE = 'PORD'

GO

IF OBJECT_ID ('viewRelabelItemAvailableDate', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRelabelItemAvailableDate] 
END

GO

CREATE VIEW [dbo].[viewRelabelItemAvailableDate]
AS
SELECT RELABELORDERITEM.RELABELORDERITEMNUMBER,
	CASE 
		WHEN 
			RELABELORDERITEM.SOURCETYPE = 'INV' 
		THEN 
			viewINVITEMAvailableDate.AvailableDate
		WHEN 
			RELABELORDERITEM.SOURCETYPE ='PRCH'
		THEN 
			PURCHASEITEM.EXPECTEDINDATE
	END AS AvailableDate
FROM dbo.RELABELORDERITEM
LEFT OUTER JOIN viewINVITEMAvailableDate
	ON viewINVITEMAvailableDate.INVITEMNUMBER = RELABELORDERITEM.INVITEMNUM
LEFT OUTER JOIN dbo.PURCHASEITEM
	ON RELABELORDERITEM.SOURCEDOC = dbo.PURCHASEITEM.PURCHASEITEMID
		AND RELABELORDERITEM.SOURCETYPE = 'PRCH'


GO

IF OBJECT_ID ('viewWorkOrderAvailableSourceStatus', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderAvailableSourceStatus] 
END


GO
CREATE VIEW [dbo].[viewWorkOrderAvailableSourceStatus]
AS
SELECT WI.WORKORDERITEMNUMBER,
	CASE 
		WHEN 
			COALESCE(WI.SOURCETYPE,'') = 'PORD' 
		THEN 
			PRO.ESTIMATEDCOMPLETIONDATE
		WHEN 
			COALESCE(WI.SOURCETYPE,'') = 'PRCH'
		THEN 
			PRCHITEM.EXPECTEDINDATE
	ELSE 
		NULL 
	END AS ExceptedDate,
	PRCHITEM.EXPECTEDINDATE,
	PRCHITEM.DATENEEDED,    
	CASE 
		WHEN
			WI.SOURCETYPE = 'PRCH' 
		THEN 
			PRCHITEM.PURCHASEITEMSTATUS
		WHEN 
			WI.SOURCETYPE = 'PORD' 
		THEN 
			PRO.ORDERSTATUS
		WHEN 
			WI.SOURCETYPE = 'RLBL' 
		THEN 
			ROI.RELABELORDERITEMSTATUS
	END AS SOURCESTATUS,    
	WI.SOURCEDOCUMENT,
	WI.SOURCETYPE,    
		CASE 
			WHEN
				ISNULL(WI.SOURCETYPE,'') = 'INV'
			THEN 
				viewINVITEMAvailableDate.AvailableDate
			WHEN 
				ISNULL(WI.SOURCETYPE,'') ='PRCH'
			THEN 
				PRCHITEM.EXPECTEDINDATE
			WHEN 
				ISNULL(WI.SOURCETYPE,'') = 'PORD'
			THEN 
				PRO.ESTIMATEDCOMPLETIONDATE
			WHEN
				ISNULL(WI.SOURCETYPE,'') = 'RLBL'
			THEN
				viewRelabelItemAvailableDate.AvailableDate
		END AS Available,
		PRO.ESTIMATEDCOMPLETIONDATE,
		PRO.NEEDEDBY
FROM WORKORDER W
	INNER JOIN WORKORDERITEM WI
		ON WI.WORKORDERNUMBER = W.WORKORDERNUMBER    
	INNER JOIN PRODUCT P
		ON P.PRODUCTID = WI.PRODUCTID
	LEFT JOIN PRODORDER PRO
		ON PRO.PRODORDERNUM = WI.SOURCEDOCUMENT AND WI.SOURCETYPE = 'PORD'
	LEFT JOIN PURCHASEITEM PRCHITEM
		ON PRCHITEM.PURCHASEITEMID = WI.SOURCEDOCUMENT AND WI.SOURCETYPE = 'PRCH'    
	LEFT OUTER JOIN viewINVITEMAvailableDate
		ON viewINVITEMAvailableDate.INVITEMNUMBER = WI.INVITEMNUMBER
	LEFT JOIN RELABELORDERITEM ROI
		ON ROI.RELABELORDERITEMNUMBER = WI.SOURCEDOCUMENT AND WI.SOURCETYPE = 'RLBL'
	LEFT OUTER JOIN viewRelabelItemAvailableDate
		ON viewRelabelItemAvailableDate.RELABELORDERITEMNUMBER = ROI.RELABELORDERITEMNUMBER

GO

IF OBJECT_ID ('viewRptWorkOrderItemFulfillmentPlan', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptWorkOrderItemFulfillmentPlan] 
END


GO
CREATE VIEW [dbo].[viewRptWorkOrderItemFulfillmentPlan]
AS
SELECT W.WORKORDERNUMBER,
	WI.WORKORDERITEMNUMBER,
	WI.ITEMTYPE,
	WI.QTY,
	WI.UNITORCONTAINER,
	WI.UOM,
	WI.ITEMID,
	WI.ITEMDESCRIPTION,
	WI.CONTAINER,
	Avail.SOURCETYPE,
	Avail.SOURCEDOCUMENT,
	WI.INVITEMNUMBER,
	Avail.ExceptedDate,
	Avail.SOURCESTATUS,	
	Avail.Available,
		PLANNEDSHIPDATE
FROM WORKORDER W
	INNER JOIN WORKORDERITEM WI ON WI.WORKORDERNUMBER = W.WORKORDERNUMBER	
	INNER JOIN PRODUCT P ON P.PRODUCTID = WI.PRODUCTID
	LEFT JOIN viewWorkOrderAvailableSourceStatus Avail
		ON Avail.WORKORDERITEMNUMBER = WI.WORKORDERITEMNUMBER
GO

IF OBJECT_ID ('viewWorkOrderItemsScreen', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderItemsScreen] 
END
GO

CREATE VIEW [dbo].[viewWorkOrderItemsScreen]
AS
SELECT dbo.WORKORDERITEM.WORKORDERITEMNUMBER
	, dbo.WORKORDERITEM.WORKORDERNUMBER
	, dbo.WORKORDERITEM.ITEMTYPE
	, dbo.WORKORDERITEM.ITEMID
	, dbo.WORKORDERITEM.ITEMDESCRIPTION
	, dbo.WORKORDERITEM.PRODUCTID
	, dbo.WORKORDERITEM.PRODUCTDESC
	, dbo.WORKORDERITEM.CONTAINER
	, dbo.WORKORDERITEM.QTY
	, dbo.WORKORDERITEM.INVITEMNUMBER
	, dbo.WORKORDERITEM.ITEMCOMMENTS
	, dbo.INVITEM.LOTNUMBER
	, dbo.WORKORDERITEM.WAREHOUSELOCATION
	, ISNULL(dbo.WORKORDERITEM.BILLABLE,0) AS  BILLABLE
	, dbo.WORKORDERITEM.UNITCOST
	, dbo.WORKORDERITEM.ITEMPRICE
	, dbo.WORKORDERITEM.ITEMPROFIT
	, dbo.WORKORDERITEM.UNITORCONTAINER
	, dbo.WORKORDERITEM.UNITS
	, dbo.WORKORDERITEM.UOM
	, Avail.SOURCETYPE
	, Avail.SOURCEDOCUMENT
	, Avail.SOURCESTATUS
	, dbo.WORKORDERITEM.WORKORDERITEMSTATUS
	, dbo.WORKORDERITEM.CUSTOMERPO
	, dbo.WORKORDERITEM.SHIPMENTITEMNUMBER
	, dbo.WORKORDERITEM.INVOICEITEMNUMBER
	, dbo.WORKORDERITEM.TOTALVOLUME
	, dbo.WORKORDERITEM.VOLUMEUOM
	, dbo.WORKORDERITEM.TOTALWEIGHT
	, dbo.WORKORDERITEM.WEIGHTUOM
	, dbo.WORKORDERITEM.DOTIDNumber
	, dbo.WORKORDERITEM.HAZMATID
	, dbo.WORKORDERITEM.HAZMATCLASS
	, dbo.WORKORDERITEM.HAZMATPACKAGEGROUP
	, dbo.WORKORDERITEM.CLASSRATE
	, dbo.WORKORDERITEM.DOTDESC
	, dbo.WORKORDERITEM.HAZMATDESC
	, dbo.WORKORDERITEM.UNLINE
	, ISNULL(dbo.WORKORDERITEM.ISHAZARDOUS,0) AS ISHAZARDOUS
	, dbo.WORKORDERITEM.ITEMNOTES
	, dbo.WORKORDERITEM.CREATEDTIME
	, dbo.WORKORDERITEM.CREATEDBY
	, dbo.WORKORDERITEM.MODIFIEDTIME
	, dbo.WORKORDERITEM.MODIFIEDBY
	, dbo.WORKORDERITEM.LD1
	, dbo.WORKORDERITEM.LD2
	, dbo.WORKORDERITEM.LD3
	, dbo.WORKORDERITEM.CUSTITEMID
	, dbo.INVITEM.ITEMSTATUS
	, dbo.WORKORDERITEM.STANDARDUNITCOST
	, dbo.WORKORDERITEM.UNITPRICE
	, dbo.WORKORDERITEM.PRICEUNITS
	, dbo.WORKORDERITEM.PRICEUOM
	, dbo.WORKORDERITEM.STANDARDCOSTUNITS
	, dbo.WORKORDERITEM.STANDARDCOSTUOM
	, dbo.WORKORDERITEM.ACTUALCOSTUNITS
	, dbo.WORKORDERITEM.ACTUALCOSTUOM
	, CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' 
		THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0) 
		ELSE ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  END AS EXTPRICE
	, CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' 
		THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0) 
		ELSE ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END AS EXTCOST
	, ISNULL(dbo.WORKORDERITEM.ACTUALUNITCOST,0) AS ACTUALUNITCOST
	, ISNULL(((CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' 
		THEN ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.PRICEUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0) 
		ELSE ISNULL(dbo.WORKORDERITEM.UNITPRICE,0) * ISNULL(dbo.WORKORDERITEM.QTY,0) END) - (
		CASE WHEN dbo.WORKORDERITEM.UNITORCONTAINER = 'C' THEN ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * 
			ISNULL(dbo.WORKORDERITEM.STANDARDCOSTUNITS,0) * ISNULL(dbo.WORKORDERITEM.QTY,0)  
		ELSE  ISNULL(dbo.WORKORDERITEM.STANDARDUNITCOST,0) * ISNULL( dbo.WORKORDERITEM.QTY,0)  END)),0) AS EXTPROFIT
	, Avail.AVAILABLE
	, Avail.EXPECTEDINDATE				
	, Avail.DATENEEDED
	, Avail.ESTIMATEDCOMPLETIONDATE
	, Avail.NEEDEDBY
FROM WORKORDER
	INNER JOIN WORKORDERITEM
		ON WORKORDERITEM.WORKORDERNUMBER = WORKORDER.WORKORDERNUMBER
	LEFT OUTER JOIN dbo.INVITEM
		ON dbo.WORKORDERITEM.INVITEMNUMBER = dbo.INVITEM.INVITEMNUMBER
	LEFT OUTER JOIN viewWorkOrderAvailableSourceStatus Avail
		ON Avail.WORKORDERITEMNUMBER = WORKORDERITEM.WORKORDERITEMNUMBER


GO


IF OBJECT_ID ('viewPurchaseItems2', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPurchaseItems2] 
END
GO

CREATE VIEW [dbo].[viewPurchaseItems2]
AS
SELECT DISTINCT dbo.PURCHASEITEM.CREATEDTIME
	, dbo.PURCHASEITEM.ITEMTYPE
	, dbo.PURCHASEITEM.QTY
	, dbo.PURCHASEITEM.UNITORCONTAINER
	, dbo.PURCHASEITEM.ITEMID
	, dbo.PURCHASEITEM.ITEMDESCRIPTION
	, dbo.PURCHASEITEM.CONTAINER
	, dbo.PURCHASEITEM.UNITSINCONTAINER
	, dbo.PURCHASEITEM.UOM
	, dbo.PURCHASEITEM.UNITCOST
	, dbo.PURCHASEITEM.DATENEEDED
	, dbo.VENDOR.VENDORNAME
	, dbo.PURCHASEITEM.SOURCETYPE
	, dbo.PURCHASEITEM.SOURCEDOCUMENT
	, dbo.CUSTOMER.CUSTNAME
	, dbo.PURCHASEITEM.PURCHASEITEMSTATUS
	, dbo.PURCHASEITEM.PURCHASEITEMTYPE
	, dbo.PURCHASEITEM.PURCHASEITEMID
	, dbo.PURCHASEITEM.PURCHASENUMBER
	, dbo.PURCHASEITEM.EXPECTEDINDATE
FROM dbo.PURCHASEITEM 
LEFT OUTER JOIN dbo.VENDOR
	ON dbo.VENDOR.VENDORID = dbo.PURCHASEITEM.VENDORID 
LEFT OUTER JOIN dbo.CUSTOMER
	ON dbo.CUSTOMER.CUSTID = dbo.PURCHASEITEM.CUSTOMERID
WHERE PURCHASEITEM.QTY > 0
GO


IF OBJECT_ID ('viewPurchaseOrderList', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPurchaseOrderList] 
END
GO

CREATE VIEW viewPurchaseOrderList
AS
SELECT [PURCHASENUMBER]
      ,[PURCHASE].[VENDORID]
	  ,[VENDORNAME]
      ,[PURCHASEDATE]
      ,[PURCHASETYPE]
      ,[PURCHASE].[TERMS]
      ,[PURCHASESTATUS]
      ,[CUSTOMERPO]
      ,[SHIPNAME]
      ,[SHIPADDRESS1]
      ,[SHIPADDRESS2]
      ,[SHIPCITY]
      ,[SHIPSTATE]
      ,[SHIPZIP]
      ,[SHIPCONTACT]
      ,[SHIPPHONE]
      ,[SUBTOTAL]
      ,[SALESTAX]
      ,[FREIGHTIN]
      ,[TOTAL]
      ,[INSTRUCTIONS]
      ,[CUSTID]
      ,[EXPECTEDINDATE]     
  FROM [dbo].[PURCHASE]
  LEFT JOIN VENDOR ON VENDOR.VENDORID = PURCHASE.VENDORID
GO

IF OBJECT_ID ('viewPurchaseItemsList', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPurchaseItemsList] 
END
GO

CREATE VIEW [dbo].[viewPurchaseItemsList]
AS
SELECT [PURCHASEITEMID]
      ,[PURCHASEITEMTYPE]
      ,[ITEMID]
      ,[ITEMTYPE]
      ,[ITEMDESCRIPTION]
      ,[QTY]
      ,[UNITORCONTAINER]
      ,[CONTAINER]
      ,[UNITSINCONTAINER]
      ,[UOM]
      ,[UNITCOST]
      ,[DATENEEDED]
      ,PRCHITEM.[VENDORID]
      ,[CUSTOMERID]
      ,[PURCHASENUMBER]
      ,PRCHITEM.[CREATEDBY]
      ,PRCHITEM.[CREATEDTIME]
      ,PRCHITEM.[MODIFYBY]
      ,PRCHITEM.[MODIFYTIME]
      ,[PURCHASEITEMSTATUS]
	  ,[SOURCETYPE]
      ,[SOURCEDOCUMENT]
      ,[VENDORITEMNUMBER]
	  ,CASE 
			WHEN [UNITORCONTAINER] = 'C' 
			THEN ISNULL([QTY],0) * ISNULL([UNITSINCONTAINER],0) * ISNULL([UNITCOST],0) 
			ELSE ISNULL([QTY],0) * ISNULL([UNITCOST],0) 
		END AS Extcost,
	  EXPECTEDINDATE,
	  VENDORNAME,
	  CUSTOMERPO
  FROM [dbo].[PURCHASEITEM] PRCHITEM
	LEFT JOIN VENDOR V ON V.VENDORID = PRCHITEM.VENDORID
  WHERE PRCHITEM.QTY > 0

  GO
  

IF OBJECT_ID ('viewVendorTestingMatrix', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewVendorTestingMatrix] 
END
GO	

CREATE view [dbo].[viewVendorTestingMatrix]
AS

SELECT A.VENDORTESTINGMATRIXID, A.VENDORID, A.CHEMICALCATEGORY, A.PRODUCTID, B.PRODUCTDESC, A.RETAINPERCENTAGE,A.TESTPERCENTAGE, A.PH, A.SG, A.COLOR, A.APPEARANCE, A.ISACTIVE 
FROM VENDORTESTINGMATRIX AS A
	INNER JOIN PRODUCT AS B ON A.PRODUCTID = B.PRODUCTID
	INNER JOIN LIST_CHEMICALCATEGORY AS C  ON A.CHEMICALCATEGORY = C.CHEMICALCATEGORY	
	INNER JOIN VENDOR V ON V.VENDORID = A.VENDORID

GO

IF OBJECT_ID ('viewPurchaseItemRequest', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPurchaseItemRequest] 
END
GO

CREATE VIEW [dbo].[viewPurchaseItemRequest]
AS
SELECT  PRCHITEM.PURCHASEITEMID, 
		PRCHITEM.CREATEDTIME,
		PRCHITEM.ITEMTYPE,
		PRCHITEM.ITEMID, 
		P.PRODUCTDESC,
		PRCHITEM.QTY,
		PRCHITEM.CONTAINER,
		PRCHITEM.DATENEEDED,
		PRCHITEM.PURCHASEITEMSTATUS,
		PRCHITEM.SOURCETYPE,
		PRCHITEM.SOURCEDOCUMENT
FROM    dbo.PURCHASEITEM AS PRCHITEM INNER JOIN
        dbo.PRODUCT AS P ON PRCHITEM.ITEMID = P.PRODUCTID INNER JOIN 
		dbo.WORKORDER W ON W.WORKORDERNUMBER = PRCHITEM.SOURCEDOCUMENT

		
GO

IF OBJECT_ID ('viewInvItemList', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewInvItemList] 
END
GO
 
CREATE VIEW [dbo].[viewInvItemList]
AS

SELECT  I.INVITEMNUMBER, 
		I.SOURCEDOCUMENT, 
		ISNULL(PRCHITEM.ITEMTYPE, 'PRODUCT') AS ITEMTYPE, 
		I.PRODUCTID AS ITEMID, 
		I.PRODUCTDESC AS ITEMDESCRIPTION, 
		I.CONTAINER,
		I.LOTNUMBER, 
		I.UNITSREMAININGWEIGHT, 
		I.RCVDWEIGHT, 
		I.VENDORWEIGHT, 
		I.UNITSREMAINING, 
		I.UOM, 
		I.ITEMSTATUS, 
		I.PRODUCTID, 
		PRCHITEM.PURCHASENUMBER, 
		CAST(0 AS bit) AS CheckMark, 
		CASE 
			WHEN 
				I.SOURCETYPE = 'PRCH' 
			THEN
				(SELECT        PURCHASEITEMSTATUS
				FROM            PURCHASEITEM
				WHERE        PURCHASEITEMID = I.SOURCEDOCUMENT) 
			WHEN 
				I.SOURCETYPE = 'PORD' 
			THEN
				(SELECT        ORDERSTATUS
				FROM            PRODORDER
				WHERE        PRODORDERNUM = I.SOURCEDOCUMENT)
		END AS SOURCESTATUS,
		LI.LookupDesc, 
		PRCHITEM.PURCHASEITEMSTATUS, 
		I.INVENTORYCLASS,
		I.SOURCETYPE,
		I.ALLOCATEDDOCUMENT,
		I.ALLOCATEDTYPE
FROM    dbo.INVITEM AS I LEFT JOIN
        dbo.PURCHASEITEM AS PRCHITEM ON PRCHITEM.PURCHASEITEMID = I.SOURCEDOCUMENT AND I.SOURCETYPE = 'PRCH'
		LEFT JOIN LIST_INVENTORYCLASS LI ON LI.LookupValue = I.INVENTORYCLASS


GO


IF OBJECT_ID ('viewRawMaterialAvailable', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRawMaterialAvailable] 
END
GO
 
CREATE VIEW [dbo].[viewRawMaterialAvailable]
AS
SELECT TOP (100) PERCENT M.MATERIALID,
			   M.MATERIALDESC,			  
			   ISNULL(MaterialPlanning.RMINVENTORY, 0) AS INVENTORY,
			   ISNULL(MaterialPlanning.RMONORDER, 0) + ISNULL(RequestedQTY.InPurchase, 0) AS RMONORDER,
			   ISNULL(DemandQTY.INPPRODUCTION, 0) AS INPPRODUCTION,
			   ISNULL(MaterialPlanning.RMINVENTORY, 0) + ISNULL(MaterialPlanning.RMONORDER, 0) 
					+ ISNULL(RequestedQTY.InPurchase, 0) - ISNULL(DemandQTY.INPPRODUCTION, 0) AS AVAILABLE			   
		FROM dbo.MATERIAL AS M
		LEFT OUTER JOIN
			(SELECT SUM(CASE WHEN ((INVENTORYCLASS = 2) AND ((ITEMSTATUS = 'IN PROCESS'))) THEN ISNULL(UNITSREMAINING, 0) ELSE 0 END) AS RMINVENTORY, 
					SUM(CASE WHEN ((INVENTORYCLASS = 2) AND (ITEMSTATUS IN ('INPROD', 'PENDING'))) THEN ISNULL(UNITSREMAINING, 0) ELSE 0 END) AS RMONORDER, 
					MATERIALID
				FROM (SELECT DISTINCT dbo.INVITEM.INVITEMNUMBER, 
									dbo.INVITEM.UNITSREMAINING, 
									dbo.INVITEM.ITEMSTATUS, 
									dbo.INVITEM.INVENTORYCLASS, 
									dbo.INVITEM.ALLOCATEDDOCUMENT, 
									dbo.MATERIALPRODUCT.MATERIALID
							FROM dbo.INVITEM
							INNER JOIN dbo.MATERIALPRODUCT
								ON dbo.INVITEM.PRODUCTID = dbo.MATERIALPRODUCT.PRODUCTID
					) AS Inv
				GROUP BY MATERIALID
			) AS MaterialPlanning
				ON M.MATERIALID = MaterialPlanning.MATERIALID
		LEFT OUTER JOIN
			(SELECT SUM(ISNULL(QTY, 0)) AS INPPRODUCTION, MATERIALID
				FROM dbo.PRODITEM
				WHERE (ISCOMPLETE = 0)
				GROUP BY MATERIALID
			) AS DemandQTY ON M.MATERIALID = DemandQTY.MATERIALID 		
		LEFT OUTER JOIN
            (SELECT SUM(ISNULL(QTY *(
						CASE WHEN PRODUCT.VOLUMEUOM = MATERIAL.MATERIALUOM
							THEN PRODUCT.VOLUMEUNITS
							WHEN PRODUCT.WEIGHTUOM = MATERIAL.MATERIALUOM
							THEN PRODUCT.WEIGHTUNITS
						END
						), 0)) AS InPurchase,
					MATERIAL.MATERIALID
				FROM dbo.PURCHASEITEM
				INNER JOIN MATERIALPRODUCT
					ON PURCHASEITEM.ITEMID = MATERIALPRODUCT.PRODUCTID
				INNER JOIN MATERIAL
					ON MATERIALPRODUCT.MATERIALID = MATERIAL.MATERIALID
				INNER JOIN PRODUCT
					ON PURCHASEITEM.ITEMID = PRODUCT.PRODUCTID
				WHERE PURCHASEITEM.PURCHASEITEMSTATUS = 'REQUESTED'
					AND PURCHASEITEM.PURCHASEITEMTYPE IN ('REGULAR', 'MATERIAL')
				GROUP BY MATERIAL.MATERIALID
			) AS RequestedQTY
			ON M.MATERIALID = RequestedQTY.MATERIALID
		ORDER BY M.MATERIALID

GO


IF OBJECT_ID ('viewProdItemData', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewProdItemData] 
END
GO

CREATE VIEW [dbo].[viewProdItemData]
AS
SELECT     dbo.PRODITEM.PRODITEMNUM, dbo.PRODITEM.PRODORDERNUM, dbo.PRODITEM.MATERIALID, dbo.PRODITEM.APISNUM, dbo.PRODITEM.UOM, 
                      dbo.PRODITEM.QTY, dbo.PRODITEM.ISCOMPLETE, dbo.viewRawMaterialAvailable.MATERIALDESC, dbo.viewRawMaterialAvailable.INVENTORY, 
                      dbo.viewRawMaterialAvailable.INPPRODUCTION AS INPROCESS, dbo.viewRawMaterialAvailable.AVAILABLE
FROM         dbo.PRODITEM INNER JOIN
                      dbo.viewRawMaterialAvailable ON dbo.PRODITEM.MATERIALID = dbo.viewRawMaterialAvailable.MATERIALID

GO

IF OBJECT_ID ('viewAppUser', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAppUser] 
END
GO
CREATE VIEW [dbo].[viewAppUser]
AS
SELECT	TOP (100) PERCENT APPUSERID, USERLOGIN
FROM	dbo.APPUSER
ORDER BY USERSTATUS, USERLOGIN
GO


IF OBJECT_ID ('viewAuditLogEmailRecipients', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewAuditLogEmailRecipients] 
END
GO
CREATE VIEW [dbo].[viewAuditLogEmailRecipients]
AS
SELECT	DISTINCT TOP (100) PERCENT  APPUSER.APPUSERID, APPUSER.USERLOGIN, AUDITCATEGORY.AUDITCATEGORY, AUDITCATEGORY.AUDITCATEGORYID
FROM	dbo.APPUSER
INNER JOIN AUDITPERMISSIONS ON AUDITPERMISSIONS.USERID = APPUSER.APPUSERID
INNER JOIN AUDITCATEGORY ON AUDITCATEGORY.AUDITCATEGORYID = AUDITPERMISSIONS.AUDITCATEGORYID
WHERE USERSTATUS = 'ACTIVE'
ORDER BY USERLOGIN
GO

IF OBJECT_ID ('viewRptInventoryProfitAndLossAnalysis', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptInventoryProfitAndLossAnalysis] 
END
GO
CREATE VIEW [dbo].[viewRptInventoryProfitAndLossAnalysis]
AS
SELECT     w.WORKORDERNUMBER, w.WORKORDERDATE, w.SUBTOTAL, c.CUSTNAME, WI.Cost, WI.Price, WI.Profit, WI.EXTPRICE, WI.STANDARDCOST, WI.ACTUALUNITCOST, 
                      WI.STDPROFIT, WI.ACTPROFIT
FROM         dbo.WORKORDER AS w INNER JOIN
                      dbo.CUSTOMER AS c ON w.CUSTID = c.CUSTID INNER JOIN
                          (SELECT     WORKORDERNUMBER, SUM(STANDARDUNITCOST * UNITS) AS Cost, SUM(EXTPRICE) AS Price, SUM(EXTPRICE - STANDARDUNITCOST * UNITS) 
                                                   AS Profit, SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE, 0) * ISNULL(b.PRICEUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.UNITPRICE, 0) * ISNULL(b.QTY, 0) END) AS EXTPRICE, 
                                                   SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST, 0) * ISNULL(b.STANDARDCOSTUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.STANDARDUNITCOST, 0) * ISNULL(b.QTY, 0) END) AS STANDARDCOST, 
                                                   SUM(CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST, 0) * ISNULL(b.ACTUALCOSTUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.ACTUALUNITCOST, 0) * ISNULL(b.QTY, 0) END) AS ACTUALUNITCOST, 
                                                   SUM(ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE, 0) * ISNULL(b.PRICEUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.UNITPRICE, 0) * ISNULL(b.QTY, 0) END) - (CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.STANDARDUNITCOST, 0) 
                                                   * ISNULL(b.STANDARDCOSTUNITS, 0) * ISNULL(b.QTY, 0) ELSE ISNULL(b.STANDARDUNITCOST, 0) * ISNULL(b.QTY, 0) END), 0)) AS STDPROFIT, 
                                                   SUM(ISNULL((CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.UNITPRICE, 0) * ISNULL(b.PRICEUNITS, 0) * ISNULL(b.QTY, 0) 
                                                   ELSE ISNULL(b.UNITPRICE, 0) * ISNULL(b.QTY, 0) END) - (CASE WHEN b.UNITORCONTAINER = 'C' THEN ISNULL(b.ACTUALUNITCOST, 0) 
                                                   * ISNULL(b.ACTUALCOSTUNITS, 0) * ISNULL(b.QTY, 0) ELSE ISNULL(b.ACTUALUNITCOST, 0) * ISNULL(b.QTY, 0) END), 0)) AS ACTPROFIT
                            FROM          dbo.WORKORDERITEM AS b
                            WHERE      (BILLABLE = 1)
                            GROUP BY WORKORDERNUMBER) AS WI ON WI.WORKORDERNUMBER = w.WORKORDERNUMBER
WHERE     (w.ORDERSTATUS NOT IN ('PENDING', 'CANCELLED'))

GO


IF OBJECT_ID ('viewWOEmailPlan', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWOEmailPlan] 
END
GO
CREATE VIEW [dbo].[viewWOEmailPlan]
AS

WITH WorkOrderItem_CTE AS (
	SELECT  W.WORKORDERNUMBER,
		WI.ITEMTYPE,
		WI.ITEMID,
		WI.CONTAINER,
		WI.ITEMDESCRIPTION,
		SUM(WI.QTY) TOTALPRODUCTQTY
	FROM  dbo.WORKORDER AS W
	INNER JOIN  dbo.WORKORDERITEM AS WI ON WI.WORKORDERNUMBER = W.WORKORDERNUMBER
	GROUP BY  W.WORKORDERNUMBER,
		WI.ITEMTYPE,
		WI.ITEMID,
		WI.CONTAINER,
		WI.ITEMDESCRIPTION
),
Fulfillment_CTE AS (
	SELECT  W.WORKORDERNUMBER,
		WI.ITEMID,
		WI.SOURCETYPE,
		SUM(WI.QTY) AS TOTALFULFILLMENTQTY
	FROM  dbo.WORKORDER AS W
	INNER JOIN  dbo.WORKORDERITEM AS WI ON WI.WORKORDERNUMBER = W.WORKORDERNUMBER
	GROUP BY W.WORKORDERNUMBER,
		WI.ITEMID,
		WI.SOURCETYPE
),
RLBL_CTE AS (
	SELECT WI.ITEMID,
		WI.WORKORDERNUMBER,
		RLBL.SOURCETYPE,
		P.PRODUCTID,
		p.PRODUCTDESC,
		P.CONTAINER,
		COUNT(RLBL.RELABELORDERITEMNUMBER) AS QTY
	FROM RELABELORDERITEM RLBL
	INNER JOIN WORKORDERITEM WI
		ON RLBL.RELABELORDERITEMNUMBER = WI.SOURCEDOCUMENT
			AND WI.SOURCETYPE = 'RLBL'
	INNER JOIN PRODUCT P
		ON P.PRODUCTID = RLBL.ITEMID
	GROUP BY WI.ITEMID,
		WI.WORKORDERNUMBER,
		RLBL.SOURCETYPE,
		P.PRODUCTID,
		p.PRODUCTDESC,
		P.CONTAINER
)
SELECT WorkOrderItem_CTE.WORKORDERNUMBER,
	WorkOrderItem_CTE.ITEMTYPE,
	WorkOrderItem_CTE.ITEMID,
	WorkOrderItem_CTE.CONTAINER,
	WorkOrderItem_CTE.ITEMDESCRIPTION,
	WorkOrderItem_CTE.TOTALPRODUCTQTY,
	Fulfillment_CTE.SOURCETYPE,
	Fulfillment_CTE.TOTALFULFILLMENTQTY,
	RLBL_CTE.SOURCETYPE AS RLBLSOURCERTYPE,
	RLBL_CTE.PRODUCTID AS RLBLPRODUCTID,
	RLBL_CTE.PRODUCTDESC AS RLBLPRODUCTDESC,
	RLBL_CTE.CONTAINER AS RLBLCONTAINER,
	RLBL_CTE.QTY AS RLBLQTY,
	LIST_FULFILLMENTTYPE.FULFILLMENTTYPEID
FROM WorkOrderItem_CTE
LEFT OUTER JOIN Fulfillment_CTE
	ON WorkOrderItem_CTE.WORKORDERNUMBER = Fulfillment_CTE.WORKORDERNUMBER
		AND WorkOrderItem_CTE.ITEMID = Fulfillment_CTE.ITEMID
LEFT OUTER JOIN RLBL_CTE
	ON RLBL_CTE.WORKORDERNUMBER = Fulfillment_CTE.WORKORDERNUMBER
		AND RLBL_CTE.ITEMID = Fulfillment_CTE.ITEMID
		AND Fulfillment_CTE.SOURCETYPE = 'RLBL'
LEFT OUTER JOIN LIST_FULFILLMENTTYPE 
	ON LIST_FULFILLMENTTYPE.FULFILLMENTTYPE = Fulfillment_CTE.SOURCETYPE


GO

/*Shaun's Changes January 2015 - Start */
	IF OBJECT_ID ('viewShipmentInfo', 'V') IS NOT NULL
	BEGIN
		DROP VIEW [viewShipmentInfo]
	END
	GO

	SET ANSI_NULLS ON
	GO

	SET QUOTED_IDENTIFIER ON
	GO

	CREATE VIEW [dbo].[viewShipmentInfo]
	AS
	SELECT     TOP (100) PERCENT s.SHIPMENTNUMBER, s.SHIPMENTDATE, s.CUSTOMERNAME, CASE WHEN s.ShipFromName IS NULL 
						  THEN s.shipfromaddress1 ELSE s.shipfromname END AS ShipperName, CASE WHEN s.ShipToName IS NULL 
						  THEN s.ShipToAddress1 ELSE s.ShipToName END AS ConsigneeName, CASE WHEN s.CarrierID IS NULL 
						  THEN s.FREIGHTCARRIER ELSE c.CARRIERNAME END AS FREIGHTCARRIER, s.FOB, SUM(d.QTYCONTAINERS) AS Containers, SUM(d.TOTALWEIGHT) AS Weight, 
						  s.SHIPMENTSTATUS, s.KEEPFROMFREEZING
	FROM         dbo.SHIPMENT AS s LEFT OUTER JOIN
						  dbo.CARRIER AS c ON s.CARRIERID = c.CarrierID LEFT OUTER JOIN
						  dbo.SHIPMENTDETAIL AS d ON s.SHIPMENTNUMBER = d.SHIPMENTNUMBER
	GROUP BY s.SHIPMENTNUMBER, s.SHIPMENTDATE, s.CUSTOMERNAME, s.SHIPFROMNAME, s.SHIPFROMADDRESS1, s.SHIPTONAME, s.SHIPTOADDRESS1, 
						  s.FREIGHTCARRIER, s.FOB, s.CARRIERID, c.CarrierName, s.SHIPMENTSTATUS, s.KEEPFROMFREEZING
	ORDER BY s.SHIPMENTNUMBER DESC

	GO

	IF OBJECT_ID ('viewRptBillOfLading2', 'V') IS NOT NULL
	BEGIN
		DROP VIEW [viewRptBillOfLading2]
	END
	GO

	SET ANSI_NULLS ON
	GO

	SET QUOTED_IDENTIFIER ON
	GO

	CREATE VIEW [dbo].[viewRptBillOfLading2]
	AS
	SELECT     TOP (100) PERCENT dbo.SHIPMENT.SHIPMENTNUMBER, dbo.SHIPMENT.SHIPMENTDATE, dbo.SHIPMENT.CUSTID, dbo.SHIPMENT.CUSTOMERNAME, 
						  dbo.SHIPMENT.SHIPFROMID, dbo.SHIPMENT.SHIPFROMNAME, dbo.SHIPMENT.SHIPFROMADDRESS1, dbo.SHIPMENT.SHIPFROMADDRESS2, 
						  dbo.SHIPMENT.SHIPFROMCITY, dbo.SHIPMENT.SHIPFROMSTATEPROV, dbo.SHIPMENT.SHIPFROMPOSTALCODE, dbo.SHIPMENT.SHIPFROMCOUNTRY, 
						  dbo.SHIPMENT.SHIPFROMPHONE, dbo.SHIPMENT.SHIPFROMFAX, dbo.SHIPMENT.SHIPFROMCONTACT, dbo.SHIPMENT.SHIPTOID, dbo.SHIPMENT.SHIPTONAME, 
						  dbo.SHIPMENT.SHIPTOADDRESS1, dbo.SHIPMENT.SHIPTOADDRESS2, dbo.SHIPMENT.SHIPTOCITY, dbo.SHIPMENT.SHIPTOSTATEPROV, 
						  dbo.SHIPMENT.SHIPTOPOSTALCODE, dbo.SHIPMENT.SHIPTOCOUNTRY, dbo.SHIPMENT.SHIPTOPHONE, dbo.SHIPMENT.CARRIERID, 
						  dbo.CARRIER.CarrierName AS FREIGHTCARRIER, dbo.SHIPMENT.FOB, dbo.SHIPMENT.CUSTOMERPO, dbo.SHIPMENT.PLACARDSREQUIRED, 
						  dbo.SHIPMENT.PLACARDSSUPPLIED, dbo.SHIPMENTDETAIL.PRODUCTID, dbo.SHIPMENTDETAIL.PRODUCTDESC, SUM(dbo.SHIPMENTDETAIL.QTYCONTAINERS) 
						  AS QTYCONTAINERS, 
						  CASE WHEN dbo.SHIPMENTDETAIL.PRODUCTID = 0 THEN dbo.SHIPMENTDETAIL.TOTALWEIGHT ELSE (SUM(dbo.SHIPMENTDETAIL.TOTALWEIGHT * dbo.SHIPMENTDETAIL.QTYCONTAINERS))
						   END AS TOTALWEIGHT, dbo.SHIPMENTDETAIL.STDWEIGHT, dbo.SHIPMENTDETAIL.STDGALLONS, dbo.SHIPMENTDETAIL.CONTAINER, 
						  dbo.SHIPMENTDETAIL.DOTDESC, dbo.SHIPMENTDETAIL.HAZMATDESC, dbo.SHIPMENTDETAIL.UNLINE, dbo.SHIPMENTDETAIL.CLASSRATE, 
						  dbo.SHIPMENTDETAIL.LD1, dbo.SHIPMENTDETAIL.LD2, dbo.SHIPMENTDETAIL.LD3, dbo.PRODUCT.HAZMATID, dbo.SHIPMENT.LOGISTICSID, 
						  dbo.LOGISTICS.LOGISTICSNAME, dbo.LOGISTICS.LOGISTICSADDR1, dbo.LOGISTICS.LOGISTICSADDR2, 
						  dbo.LOGISTICS.LOGISTICSCITY + ', ' + dbo.LOGISTICS.LOGISTICSSTATE + '  ' + dbo.LOGISTICS.LOGISTICSZIP AS LOGISTICSCSZ, dbo.PRODUCT.ISLIQUID, 
						  dbo.SHIPMENT.COMMENTS, dbo.SHIPMENT.SHIPTONAME AS SHIPTOLINE1, dbo.SHIPMENT.SHIPTOADDRESS1 AS SHIPTOLINE2, 
						  dbo.SHIPMENT.SHIPTOADDRESS2 AS SHIPTOLINE3, 
						  dbo.SHIPMENT.SHIPTOCITY + ', ' + dbo.SHIPMENT.SHIPTOSTATEPROV + '  ' + dbo.SHIPMENT.SHIPTOPOSTALCODE AS SHIPTOLINE4, 
						  dbo.SHIPMENT.SHIPFROMNAME AS SHIPFROMLINE1, dbo.SHIPMENT.SHIPFROMADDRESS1 AS SHIPFROMLINE2, 
						  dbo.SHIPMENT.SHIPFROMADDRESS2 AS SHIPFROMLINE3, 
						  dbo.SHIPMENT.SHIPFROMCITY + ', ' + dbo.SHIPMENT.SHIPFROMSTATEPROV + '  ' + dbo.SHIPMENT.SHIPFROMPOSTALCODE AS SHIPFROMLINE4, 
						  dbo.PRODUCT.UNNUMBER, dbo.LOGISTICS.LOGISTICSCITY, dbo.LOGISTICS.LOGISTICSSTATE, dbo.LOGISTICS.LOGISTICSZIP, dbo.LOGISTICS.LOGISTICSPHONE, 
						  dbo.LOGISTICS.LOGISTICSCONTACT, dbo.PRODUCT.HAZCLASSNUMBER, dbo.PRODUCT.PACKAGEGROUP, dbo.PRODUCT.CHEMICALID, 
						  dbo.CONTAINER.Container AS Expr1, dbo.PRODUCT.IDNUMBER, dbo.PRODUCT.ISTOXIC, dbo.SHIPMENT.KEEPFROMFREEZING
	FROM         dbo.SHIPMENT INNER JOIN
						  dbo.SHIPMENTDETAIL ON dbo.SHIPMENT.SHIPMENTNUMBER = dbo.SHIPMENTDETAIL.SHIPMENTNUMBER LEFT OUTER JOIN
						  dbo.PRODUCT ON dbo.SHIPMENTDETAIL.PRODUCTID = dbo.PRODUCT.PRODUCTID LEFT OUTER JOIN
						  dbo.CONTAINER ON dbo.SHIPMENTDETAIL.CONTAINER = dbo.CONTAINER.Container LEFT OUTER JOIN
						  dbo.LOGISTICS ON dbo.SHIPMENT.LOGISTICSID = dbo.LOGISTICS.LOGISTICSID LEFT OUTER JOIN
						  dbo.CARRIER ON dbo.SHIPMENT.CARRIERID = dbo.CARRIER.CarrierID
	GROUP BY dbo.SHIPMENT.SHIPMENTNUMBER, dbo.SHIPMENT.SHIPMENTDATE, dbo.SHIPMENT.WORKORDERNUMBER, dbo.SHIPMENT.CUSTID, 
						  dbo.SHIPMENT.CUSTOMERNAME, dbo.SHIPMENT.SHIPFROMID, dbo.SHIPMENT.SHIPFROMNAME, dbo.SHIPMENT.SHIPFROMADDRESS1, 
						  dbo.SHIPMENT.SHIPFROMADDRESS2, dbo.SHIPMENT.SHIPFROMCITY, dbo.SHIPMENT.SHIPFROMSTATEPROV, dbo.SHIPMENT.SHIPFROMPOSTALCODE, 
						  dbo.SHIPMENT.SHIPFROMCOUNTRY, dbo.SHIPMENT.SHIPFROMPHONE, dbo.SHIPMENT.SHIPFROMFAX, dbo.SHIPMENT.SHIPFROMCONTACT, 
						  dbo.SHIPMENT.SHIPTOID, dbo.SHIPMENT.SHIPTONAME, dbo.SHIPMENT.SHIPTOADDRESS1, dbo.SHIPMENT.SHIPTOADDRESS2, dbo.SHIPMENT.SHIPTOCITY, 
						  dbo.SHIPMENT.SHIPTOSTATEPROV, dbo.SHIPMENT.SHIPTOPOSTALCODE, dbo.SHIPMENT.SHIPTOCOUNTRY, dbo.SHIPMENT.SHIPTOPHONE, 
						  dbo.SHIPMENT.CARRIERID, dbo.CARRIER.CarrierName, dbo.SHIPMENT.FOB, dbo.SHIPMENT.CUSTOMERPO, dbo.SHIPMENT.PLACARDSREQUIRED, 
						  dbo.SHIPMENT.PLACARDSSUPPLIED, dbo.SHIPMENTDETAIL.PRODUCTID, dbo.SHIPMENTDETAIL.PRODUCTDESC, dbo.SHIPMENTDETAIL.STDWEIGHT, 
						  dbo.SHIPMENTDETAIL.STDGALLONS, dbo.SHIPMENTDETAIL.CONTAINER, dbo.SHIPMENTDETAIL.DOTDESC, dbo.SHIPMENTDETAIL.HAZMATDESC, 
						  dbo.SHIPMENTDETAIL.UNLINE, dbo.SHIPMENTDETAIL.CLASSRATE, dbo.SHIPMENTDETAIL.LD1, dbo.SHIPMENTDETAIL.LD2, dbo.SHIPMENTDETAIL.LD3, 
						  dbo.SHIPMENTDETAIL.TOTALWEIGHT, dbo.PRODUCT.HAZMATID, dbo.SHIPMENT.LOGISTICSID, dbo.LOGISTICS.LOGISTICSNAME, dbo.LOGISTICS.LOGISTICSADDR1, 
						  dbo.LOGISTICS.LOGISTICSADDR2, dbo.LOGISTICS.LOGISTICSCITY, dbo.LOGISTICS.LOGISTICSSTATE, dbo.LOGISTICS.LOGISTICSZIP, dbo.PRODUCT.ISLIQUID, 
						  dbo.SHIPMENT.COMMENTS, dbo.PRODUCT.UNNUMBER, dbo.LOGISTICS.LOGISTICSPHONE, dbo.LOGISTICS.LOGISTICSCONTACT, 
						  dbo.PRODUCT.HAZCLASSNUMBER, dbo.PRODUCT.PACKAGEGROUP, dbo.PRODUCT.CHEMICALID, dbo.CONTAINER.Container, dbo.PRODUCT.IDNUMBER, 
						  dbo.PRODUCT.ISTOXIC, dbo.SHIPMENT.KEEPFROMFREEZING
	ORDER BY dbo.PRODUCT.HAZMATID DESC

	GO
/*Shaun's Changes January 2015 - End */


IF OBJECT_ID ('viewRawMaterialTotalAvailable', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRawMaterialTotalAvailable] 
END
GO

IF OBJECT_ID ('viewRawMaterialAvailability', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRawMaterialAvailability] 
END
GO
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[viewRawMaterialAvailability]
AS
SELECT     dbo.MATERIAL.MATERIALID, dbo.MATERIAL.MATERIALDESC, ISNULL
                          ((SELECT     SUM(ISNULL(UNITSREMAINING, 0)) AS Expr1
                              FROM      dbo.INVITEM
                              WHERE     (PRODUCTID IN
                                                        (SELECT     PRODUCTID
                                                          FROM          dbo.MATERIALPRODUCT
                                                          WHERE      (MATERIALID = dbo.MATERIAL.MATERIALID))) AND (INVENTORYCLASS = 2) AND (ITEMSTATUS = 'IN PROCESS')), 0) AS INVENTORY, 
                    ISNULL((SELECT     SUM(ISNULL(UNITSREMAINING, 0)) AS Expr2
							FROM      dbo.INVITEM
							WHERE     (PRODUCTID IN
													(SELECT     PRODUCTID
														FROM          dbo.MATERIALPRODUCT
														WHERE      (MATERIALID = dbo.MATERIAL.MATERIALID))) AND (INVENTORYCLASS = 2) AND (ITEMSTATUS IN ('INPROD', 'PENDING'))), 0) AS ONORDER, 
                    ISNULL
                        ((SELECT     SUM(ISNULL(QTY, 0)) AS Expr3
                            FROM         dbo.PRODITEM
                            WHERE     (MATERIALID = dbo.MATERIAL.MATERIALID) AND (ISCOMPLETE = 0)), 0) AS INPROCESS,
					ISNULL
                        ((SELECT     SUM(ISNULL(UNITSREMAINING, 0)) AS Expr1
                            FROM      dbo.INVITEM
                            WHERE     (PRODUCTID IN
                                                    (SELECT     PRODUCTID
                                                        FROM          dbo.MATERIALPRODUCT
                                                        WHERE      (MATERIALID = dbo.MATERIAL.MATERIALID))) AND (INVENTORYCLASS = 2) AND (ITEMSTATUS = 'IN PROCESS')), 0) +
                        ISNULL((SELECT     SUM(ISNULL(UNITSREMAINING, 0)) AS Expr2
								FROM      dbo.INVITEM
								WHERE     (PRODUCTID IN
														(SELECT     PRODUCTID
															FROM          dbo.MATERIALPRODUCT
															WHERE      (MATERIALID = dbo.MATERIAL.MATERIALID))) AND (INVENTORYCLASS = 2) AND (ITEMSTATUS IN ('INPROD', 'PENDING'))), 0) -
                    ISNULL
                        ((SELECT     SUM(ISNULL(QTY, 0)) AS Expr3
                            FROM         dbo.PRODITEM
                            WHERE     (MATERIALID = dbo.MATERIAL.MATERIALID) AND (ISCOMPLETE = 0)), 0) AS AVAILABLE
FROM         dbo.PRODUCT INNER JOIN
                      dbo.MATERIALPRODUCT AS MATERIALPRODUCT_1 ON dbo.PRODUCT.PRODUCTID = MATERIALPRODUCT_1.PRODUCTID LEFT OUTER JOIN
                      dbo.INVITEM AS INVITEM_1 ON dbo.PRODUCT.PRODUCTID = INVITEM_1.PRODUCTID RIGHT OUTER JOIN
                      dbo.MATERIAL ON MATERIALPRODUCT_1.MATERIALID = dbo.MATERIAL.MATERIALID
GROUP BY dbo.MATERIAL.MATERIALID, dbo.MATERIAL.MATERIALDESC

GO

IF OBJECT_ID ('viewRMAvailableByProduct', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRMAvailableByProduct] 
END
GO

CREATE VIEW [dbo].[viewRMAvailableByProduct]
AS

	SELECT SUM(AVAILABLE) AS TOTALAVAILABLE,PRODUCTID FROM [viewRawMaterialAvailability]
	JOIN MATERIALPRODUCT 
		ON [viewRawMaterialAvailability].MATERIALID = MATERIALPRODUCT.MATERIALID	
	GROUP BY PRODUCTID


GO

IF OBJECT_ID ('viewWOItemExpectedAfterDateNeeded', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWOItemExpectedAfterDateNeeded] 
END
GO

CREATE VIEW [dbo].[viewWOItemExpectedAfterDateNeeded]
AS
SELECT WORKORDERITEM.WORKORDERNUMBER
	,SUM(CASE WHEN (Avail.EXPECTEDINDATE IS NOT NULL AND 
			Avail.DATENEEDED IS NOT NULL AND
			Avail.EXPECTEDINDATE > Avail.DATENEEDED) OR
			(Avail.ESTIMATEDCOMPLETIONDATE IS NOT NULL AND 
			Avail.NEEDEDBY IS NOT NULL AND 
			Avail.ESTIMATEDCOMPLETIONDATE > Avail.NEEDEDBY)
		THEN 1
		ELSE 0 END) AS ITEMSEXPECTEDAFTERDATENEEDED
FROM viewWorkOrderAvailableSourceStatus AS Avail
INNER JOIN WORKORDERITEM
	ON Avail.WORKORDERITEMNUMBER = WORKORDERITEM.WORKORDERITEMNUMBER
GROUP BY WORKORDERITEM.WORKORDERNUMBER

  GO

IF OBJECT_ID ('viewWorkOrdersInProcess', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrdersInProcess] 
END
GO

CREATE VIEW [dbo].[viewWorkOrdersInProcess]
AS
SELECT     w.WORKORDERNUMBER, w.WORKORDERDATE, w.CUSTID, c.CUSTNAME, w.CUSTOMERPO, w.PLANNEDSHIPDATE, w.DELIVERYDATE, w.ORDERNOTES, 
                      w.WORKORDERTYPE, w.ORDERSTATUS, CASE WHEN w.OnHold = 1 THEN 'X' ELSE '' END AS OnHold,
                          (SELECT     ISNULL(SUM(QTY), 0) AS Expr1
                            FROM          dbo.WORKORDERITEM
                            WHERE      (WORKORDERNUMBER = w.WORKORDERNUMBER)) AS ContainerQty,
                          (SELECT     ISNULL(SUM(QTY), 0) AS Expr1
                            FROM          dbo.WORKORDERITEM AS WORKORDERITEM_3
                            WHERE      (WORKORDERNUMBER = w.WORKORDERNUMBER) AND (INVITEMNUMBER IS NULL) AND (SOURCETYPE IS NULL)) AS UnAllocatedQty,
                          (SELECT     ISNULL(SUM(QTY), 0) AS Expr1
                            FROM          dbo.WORKORDERITEM AS WORKORDERITEM_2
                            WHERE      (WORKORDERNUMBER = w.WORKORDERNUMBER) AND (SOURCETYPE = 'PORD') AND (INVITEMNUMBER IS NULL)) AS OpenProdOrderQty,
                          (SELECT     ISNULL(SUM(QTY), 0) AS Expr1
                            FROM          dbo.WORKORDERITEM AS WORKORDERITEM_1
                            WHERE      (WORKORDERNUMBER = w.WORKORDERNUMBER) AND (SOURCETYPE = 'PRCH') AND (INVITEMNUMBER IS NULL)) AS OpenReqQty, w.BILLINGTYPE, 
                      w.TRANSPORTTYPE, w.ORDERTYPE
					  ,vExpectedIn.ITEMSEXPECTEDAFTERDATENEEDED
FROM         dbo.WORKORDER AS w
LEFT OUTER JOIN dbo.CUSTOMER AS c ON w.CUSTID = c.CUSTID
INNER JOIN viewWOItemExpectedAfterDateNeeded AS vExpectedIn
	ON w.WORKORDERNUMBER = vExpectedIn.WORKORDERNUMBER
WHERE     (w.ORDERSTATUS = 'IN PROCESS')
GROUP BY w.WORKORDERNUMBER, w.WORKORDERDATE, w.CUSTID, c.CUSTNAME, w.CUSTOMERPO, w.PLANNEDSHIPDATE, w.DELIVERYDATE, w.ORDERNOTES, 
                      w.WORKORDERTYPE, w.ORDERSTATUS, w.ONHOLD, w.BILLINGTYPE, w.TRANSPORTTYPE, w.ORDERTYPE, vExpectedIn.ITEMSEXPECTEDAFTERDATENEEDED

GO

IF OBJECT_ID ('viewWorkOrderAllocatedItem', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewWorkOrderAllocatedItem] 
END
GO

CREATE VIEW [dbo].[viewWorkOrderAllocatedItem]
AS
SELECT DISTINCT WORKORDERITEM.WORKORDERNUMBER
	,WORKORDERITEM.SOURCETYPE
	,WORKORDERITEM.SOURCEDOCUMENT
FROM WORKORDERITEM
WHERE WORKORDERITEM.SOURCETYPE IN ('PORD', 'PRCH', 'RLBL')


GO

IF OBJECT_ID ('viewRptWorkOrderAllocatedItem', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptWorkOrderAllocatedItem] 
END

GO

/****** Object:  View [dbo].[viewMaterialAPISList]    Script Date: 02/26/2015 12:37:28 ******/
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[viewMaterialAPISList]'))
DROP VIEW [dbo].[viewMaterialAPISList]
GO

/****** Object:  View [dbo].[viewMaterialAPISList]    Script Date: 02/26/2015 12:37:28 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[viewMaterialAPISList]
AS
SELECT     i.MATERIALID, m.MATERIALDESC, a.APISNUM, a.PRODUCTID, p.PRODUCTDESC, p.CONTAINER, i.QTYUNITS, i.UOM, a.APISSTATUS
FROM         dbo.APISITEM AS i INNER JOIN
                      dbo.MATERIAL AS m ON i.MATERIALID = m.MATERIALID INNER JOIN
                      dbo.APIS AS a ON i.APISNUM = a.APISNUM INNER JOIN
                      dbo.PRODUCT AS p ON a.PRODUCTID = p.PRODUCTID

GO

/****** Object:  View [dbo].[viewRawDataCustomerSalesInvoiceDateRestricted]    Script Date: 02/26/2015 12:44:46 ******/
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[viewRawDataCustomerSalesInvoiceDateRestricted]'))
DROP VIEW [dbo].[viewRawDataCustomerSalesInvoiceDateRestricted]
GO

/****** Object:  View [dbo].[viewRawDataCustomerSalesInvoiceDateRestricted]    Script Date: 02/26/2015 12:44:46 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[viewRawDataCustomerSalesInvoiceDateRestricted]
AS
SELECT     CustID, YEAR, [Jan] AS JAN, [Feb] AS FEB, [Mar] AS MAR, [Apr] AS APR, [May] AS MAY, [Jun] AS JUN, [Jul] AS JUL, [Aug] AS AUG, [Sep] AS SEP, [Oct] AS OCT, 
                      [Nov] AS NOV, [Dec] AS DEC
FROM         (SELECT     i.CUSTID, CONVERT(char(3), i.INVOICEDATE, 0) AS MON, DATEPART(YEAR, i.INVOICEDATE) AS YEAR, cast(SUM(ii.EXTPRICE) AS decimal(14, 2)) 
                                              AS SALES
                       FROM          dbo.RPT_SALESINVOICEDATA AS i INNER JOIN
                                              dbo.INVOICEITEM AS ii ON i.INVOICENUMBER = ii.INVOICENUMBER
                       WHERE      ii.PRODUCTID > 0 AND (ii.INVOICEITEMNUMBER NOT IN
                                                  (SELECT     INVOICEITEMNUMBER
                                                    FROM          viewInvoiceItemProductCustomerExclusionsFromSalesAnalysis))
                       GROUP BY i.CUSTID, CONVERT(char(3), i.INVOICEDATE, 0), DATEPART(YEAR, i.INVOICEDATE)) csg PIVOT (SUM(Sales) FOR MON IN ([Jan], [Feb], [Mar], [Apr], [May], 
                      [Jun], [Jul], [Aug], [Sep], [Oct], [Nov], [Dec])) AS pvt      

GO


/****** Object:  View [dbo].[viewCustomerSalesDataInvoiceDateRestricted]    Script Date: 02/26/2015 12:40:17 ******/
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[viewCustomerSalesDataInvoiceDateRestricted]'))
DROP VIEW [dbo].[viewCustomerSalesDataInvoiceDateRestricted]
GO

/****** Object:  View [dbo].[viewCustomerSalesDataInvoiceDateRestricted]    Script Date: 02/26/2015 12:40:17 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[viewCustomerSalesDataInvoiceDateRestricted]
AS
SELECT     TOP (100) PERCENT c.CUSTID, c.CUSTNAME, c.SALESPERSONID AS SalesID1, s1.SALESPERSONFULLNAME AS SName1, 
                      c.SECONDARYSALESPERSONID AS SalesID2, s2.SALESPERSONFULLNAME AS SName2, g.YEAR, ISNULL(g.JAN, 0) AS JAN, ISNULL(g.FEB, 0) AS FEB, ISNULL(g.MAR, 
                      0) AS MAR, ISNULL(g.JAN, 0) + ISNULL(g.FEB, 0) + ISNULL(g.MAR, 0) AS QTR1, ISNULL(g.APR, 0) AS APR, ISNULL(g.MAY, 0) AS MAY, ISNULL(g.JUN, 0) AS JUN, 
                      ISNULL(g.APR, 0) + ISNULL(g.MAY, 0) + ISNULL(g.JUN, 0) AS QTR2, ISNULL(g.JUL, 0) AS JUL, ISNULL(g.AUG, 0) AS AUG, ISNULL(g.SEP, 0) AS SEP, ISNULL(g.JUL, 0) 
                      + ISNULL(g.AUG, 0) + ISNULL(g.SEP, 0) AS QTR3, ISNULL(g.OCT, 0) AS OCT, ISNULL(g.NOV, 0) AS NOV, ISNULL(g.DEC, 0) AS DEC, ISNULL(g.OCT, 0) + ISNULL(g.NOV, 
                      0) + ISNULL(g.DEC, 0) AS QTR4, ISNULL(g.JAN, 0) + ISNULL(g.FEB, 0) + ISNULL(g.MAR, 0) + ISNULL(g.APR, 0) + ISNULL(g.MAY, 0) + ISNULL(g.JUN, 0) + ISNULL(g.JUL, 
                      0) + ISNULL(g.AUG, 0) + ISNULL(g.SEP, 0) + ISNULL(g.OCT, 0) + ISNULL(g.NOV, 0) + ISNULL(g.DEC, 0) AS YTD, s1.SALESLEVEL, c.SALESBYCUSTOMERREPORT
FROM         dbo.CUSTOMER AS c INNER JOIN
                      dbo.SALESPERSON AS s1 ON c.SALESPERSONID = s1.SALESPERSONID LEFT OUTER JOIN
                      dbo.SALESPERSON AS s2 ON c.SECONDARYSALESPERSONID = s2.SALESPERSONID INNER JOIN
                      dbo.viewRawDataCustomerSalesInvoiceDateRestricted AS g ON c.CUSTID = g.CustID
ORDER BY c.CUSTID, g.YEAR

GO

/****** Object:  View [dbo].[viewProductionOrderMaterialTransactions]    Script Date: 02/26/2015 12:43:52 ******/
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[viewProductionOrderMaterialTransactions]'))
DROP VIEW [dbo].[viewProductionOrderMaterialTransactions]
GO

CREATE VIEW [dbo].[viewProductionOrderMaterialTransactions]
AS
SELECT     p.PRODORDERNUM, p.PRODORDERDATE, p.PRODUCTID, pr.PRODUCTDESC, pr.CONTAINER, p.PRODUCTQTY, p.CUSTID, c.CUSTNAME, p.LOTNUMBER, 
                      p.WORKORDERNUMBER, p.COMPLETIONTIME, p.ISCOMPLETE, pri.MATERIALID, i.INVITEMNUMBER, i.UNITSUSED, inv.PRODUCTID AS RMID, 
                      pr2.PRODUCTDESC AS RMDesc, pr2.CONTAINER AS RMContainer, inv.LOTNUMBER AS RMLotNum
FROM         dbo.CUSTOMER AS c RIGHT OUTER JOIN
                      dbo.PRODORDER AS p INNER JOIN
                      dbo.PRODUCT AS pr ON p.PRODUCTID = pr.PRODUCTID INNER JOIN
                      dbo.PRODITEM AS pri ON p.PRODORDERNUM = pri.PRODORDERNUM INNER JOIN
                      dbo.INVITEM AS inv INNER JOIN
                      dbo.INVTX AS i ON inv.INVITEMNUMBER = i.INVITEMNUMBER INNER JOIN
                      dbo.PRODUCT AS pr2 ON inv.PRODUCTID = pr2.PRODUCTID ON pri.PRODITEMNUM = i.TXDOCID ON c.CUSTID = p.CUSTID
WHERE     (i.TXTYPE = 'ProdOrder')

GO



/****** Object:  View [dbo].[viewSalespersonCustomerDetailedData]    Script Date: 02/26/2015 12:45:45 ******/
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[viewSalespersonCustomerDetailedData]'))
DROP VIEW [dbo].[viewSalespersonCustomerDetailedData]
GO

CREATE VIEW [dbo].[viewSalespersonCustomerDetailedData]
AS
SELECT     SalesID1, SName1 AS SalesName, CUSTID AS ID, CUSTNAME, SName2 AS ServiceRep, YEAR, JAN, FEB, MAR, QTR1, APR, MAY, JUN, QTR2, JUL, AUG, SEP, QTR3, 
                      OCT, NOV, DEC, QTR4, YTD
FROM         dbo.viewCustomerSalesDataInvoiceDateRestricted

GO


/****** Object:  View [dbo].[viewSalesQtrlyTotalsInvoiceDateRestricted]    Script Date: 02/26/2015 12:46:15 ******/
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[viewSalesQtrlyTotalsInvoiceDateRestricted]'))
DROP VIEW [dbo].[viewSalesQtrlyTotalsInvoiceDateRestricted]
GO


CREATE VIEW [dbo].[viewSalesQtrlyTotalsInvoiceDateRestricted]
AS
SELECT     TOP (100) PERCENT SalesID1, SName1, SALESLEVEL, SALESBYCUSTOMERREPORT, YEAR, SUM(QTR1) AS Qtr1, SUM(QTR2) AS Qtr2, SUM(QTR3) AS Qtr3, 
                      SUM(QTR4) AS Qtr4, SUM(YTD) AS YTD
FROM         dbo.viewCustomerSalesDataInvoiceDateRestricted
GROUP BY SalesID1, SName1, SALESLEVEL, SALESBYCUSTOMERREPORT, YEAR
ORDER BY SName1, YEAR

GO


IF OBJECT_ID ('viewInvItemDetails', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewInvItemDetails] 
END
GO

CREATE VIEW [dbo].[viewInvItemDetails]
AS
SELECT      dbo.INVITEM.INVITEMNUMBER, dbo.INVITEM.PRODUCTID, dbo.PRODUCT.PRODUCTDESC, dbo.PRODUCT.CONTAINER, dbo.INVITEM.SHIPMENTNUMBER, dbo.SHIPMENT.SHIPMENTDATE, 
			dbo.INVITEM.SHIPPEDDATE, dbo.INVITEM.RECEIVEDDATE, dbo.INVITEM.LOTNUMBER, dbo.INVITEM.WAREHOUSELOCATION, dbo.INVITEM.WAREHOUSENUMBER, dbo.INVITEM.ALLOCATEDDATE, 
			dbo.INVITEM.RECEIVERNUMBER, dbo.INVITEM.ITEMSTATUS, dbo.INVITEM.INVENTORYCLASS, dbo.LIST_INVENTORYCLASS.LookupDesc AS CLASSDESC, dbo.INVITEM.UNITSREMAINING, 
			dbo.RECEIVER.RECEIVERDOCUMENT, dbo.RECEIVER.RECEIVERDOCUMENTTYPE, dbo.RECEIVER.PONUMBER, dbo.RECEIVER.PURCHASERELEASENUMBER, dbo.VENDOR.VENDORNAME, 
			dbo.PO.PODATE, dbo.PO.CHANGEABLEPONUMBER, dbo.INVITEM.ALLOCATEDDOCUMENT, dbo.INVITEM.ALLOCATEDTYPE, dbo.WORKORDERITEM.WORKORDERNUMBER, 
			dbo.CUSTOMER.CUSTNAME AS WORKORDERCUSTOMER, CUSTOMER_1.CUSTNAME AS SHIPTOCUSTOMER, dbo.WORKORDER.PLANNEDSHIPDATE, 
			CASE
				WHEN
					dbo.INVITEM.RECEIVEDDATE IS NULL
				THEN
					dbo.viewINVITEMAvailableDate.AvailableDate
			END AvailableDate,
			dbo.INVITEM.SOURCEDOCUMENT, dbo.INVITEM.SOURCETYPE, dbo.viewINVITEMAvailableDate.SOURCESTATUS
FROM        
			dbo.CUSTOMER INNER JOIN
            dbo.WORKORDER INNER JOIN
            dbo.WORKORDERITEM ON dbo.WORKORDER.WORKORDERNUMBER = dbo.WORKORDERITEM.WORKORDERNUMBER ON 
            dbo.CUSTOMER.CUSTID = dbo.WORKORDER.CUSTID RIGHT OUTER JOIN
            dbo.CUSTOMER AS CUSTOMER_1 INNER JOIN
            dbo.SHIPMENT ON CUSTOMER_1.CUSTID = dbo.SHIPMENT.CUSTID RIGHT OUTER JOIN
            dbo.INVITEM INNER JOIN
            dbo.PRODUCT ON dbo.INVITEM.PRODUCTID = dbo.PRODUCT.PRODUCTID LEFT OUTER JOIN
            dbo.VENDOR INNER JOIN
            dbo.RECEIVER INNER JOIN
            dbo.PO ON dbo.RECEIVER.PONUMBER = dbo.PO.PONUMBER ON dbo.VENDOR.VENDORID = dbo.PO.VENDORID ON 
            dbo.INVITEM.RECEIVERNUMBER = dbo.RECEIVER.RECEIVERNUMBER LEFT OUTER JOIN
            dbo.LIST_INVENTORYCLASS ON dbo.INVITEM.INVENTORYCLASS = dbo.LIST_INVENTORYCLASS.LookupValue ON dbo.SHIPMENT.SHIPMENTNUMBER = dbo.INVITEM.SHIPMENTNUMBER ON 
            dbo.WORKORDERITEM.INVITEMNUMBER = dbo.INVITEM.INVITEMNUMBER
			LEFT OUTER JOIN viewINVITEMAvailableDate ON viewINVITEMAvailableDate.INVITEMNUMBER = INVITEM.INVITEMNUMBER
GO


IF OBJECT_ID ('viewRptPurchaseItemFulfillmentPlan', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptPurchaseItemFulfillmentPlan] 
END
GO

CREATE VIEW [dbo].[viewRptPurchaseItemFulfillmentPlan] 
AS
SELECT DISTINCT 
                         W.WORKORDERNUMBER, PRCHITEM.PURCHASEITEMID, PRCHITEM.ITEMTYPE, PRCHITEM.QTY, PRCHITEM.UNITORCONTAINER, PRCHITEM.ITEMID, PRCHITEM.ITEMDESCRIPTION, PRCHITEM.CONTAINER, WI.SOURCETYPE, 
                         V.VENDORNAME, PRCHITEM.PURCHASENUMBER, PRCHITEM.DATENEEDED, PRCHITEM.PURCHASEITEMSTATUS, PRCHITEM.EXPECTEDINDATE
FROM            dbo.WORKORDER AS W INNER JOIN
                         dbo.WORKORDERITEM AS WI ON WI.WORKORDERNUMBER = W.WORKORDERNUMBER INNER JOIN
						 dbo.viewWorkOrderAvailableSourceStatus AS Avail ON WI.WORKORDERITEMNUMBER = Avail.WORKORDERITEMNUMBER INNER JOIN
                         dbo.PURCHASEITEM AS PRCHITEM ON PRCHITEM.PURCHASEITEMID = Avail.SOURCEDOCUMENT AND Avail.SOURCETYPE = 'PRCH' LEFT OUTER JOIN
                         dbo.VENDOR AS V ON V.VENDORID = PRCHITEM.VENDORID
 
 
GO

IF OBJECT_ID ('viewProdOrderData', 'V') IS NOT NULL
BEGIN
	DROP VIEW viewProdOrderData 
END
GO

CREATE VIEW [dbo].[viewProdOrderData]
AS
SELECT     a.PRODORDERNUM, a.PRODORDERDATE, a.CREATEDBY, a.PRODUCTID, a.PRODUCTQTY, a.APISNUM, a.CUSTID, a.LOTNUMBER, a.NEEDEDBY, a.ISCOMPLETE, 
                      b.PRODUCTDESC, b.CONTAINER, b.UOM, c.CUSTNAME, a.WORKORDERNUMBER, a.ORDERSTATUS, ESTIMATEDCOMPLETIONDATE
FROM         dbo.PRODORDER AS a INNER JOIN
                      dbo.PRODUCT AS b ON a.PRODUCTID = b.PRODUCTID LEFT OUTER JOIN
                      dbo.CUSTOMER AS c ON a.CUSTID = c.CUSTID


GO


IF OBJECT_ID ('viewProductListByProductCost', 'V') IS NOT NULL
BEGIN
	DROP VIEW viewProductListByProductCost 
END
GO


CREATE VIEW [dbo].[viewProductListByProductCost]
AS
SELECT DISTINCT PC.VENDORID,P.PRODUCTID,P.PRODUCTDESC,P.CONTAINER,P.UNITS,P.UOM
FROM PRODUCTCOST PC
INNER JOIN PRODUCT P ON P.PRODUCTID = PC.PRODUCTID

GO



IF OBJECT_ID ('viewPrchItemExpectedAfterDateNeeded', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPrchItemExpectedAfterDateNeeded] 
END
GO

CREATE VIEW [dbo].[viewPrchItemExpectedAfterDateNeeded]
AS
SELECT PURCHASEITEM.PURCHASENUMBER
	,SUM(CASE WHEN (PURCHASEITEM.EXPECTEDINDATE IS NOT NULL AND 
			PURCHASEITEM.DATENEEDED IS NOT NULL AND
			PURCHASEITEM.EXPECTEDINDATE > PURCHASEITEM.DATENEEDED)
		THEN 1
		ELSE 0 END) AS ITEMSEXPECTEDAFTERDATENEEDED
FROM PURCHASEITEM
GROUP BY PURCHASEITEM.PURCHASENUMBER
GO



IF OBJECT_ID ('viewPurchaseOrders', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewPurchaseOrders] 
END
GO

CREATE VIEW [dbo].[viewPurchaseOrders]
AS
SELECT PURCHASE.[PURCHASENUMBER]
      ,[VENDORID]
      ,[PURCHASEDATE]
      ,[PURCHASETYPE]
      ,[TERMS]
      ,[PURCHASESTATUS]
      ,[CUSTOMERPO]
      ,[SHIPNAME]
      ,[SHIPADDRESS1]
      ,[SHIPADDRESS2]
      ,[SHIPCITY]
      ,[SHIPSTATE]
      ,[SHIPZIP]
      ,[SHIPCONTACT]
      ,[SHIPPHONE]
      ,[SUBTOTAL]
      ,[SALESTAX]
      ,[FREIGHTIN]
      ,[TOTAL]
      ,[INSTRUCTIONS]
      ,[CUSTID]
      ,[EXPECTEDINDATE]
      ,[CREATEDBY]
      ,[CREATEDTIME]
      ,[MODIFYBY]
      ,[MODIFYTIME]
	  ,ISNULL(Expt.ITEMSEXPECTEDAFTERDATENEEDED,0) AS ITEMSEXPECTEDAFTERDATENEEDED
FROM PURCHASE
LEFT OUTER JOIN viewPrchItemExpectedAfterDateNeeded Expt
	ON PURCHASE.PURCHASENUMBER = Expt.PURCHASENUMBER
GO

IF OBJECT_ID ('viewMaterialPlanningList', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewMaterialPlanningList] 
END
GO

CREATE VIEW[dbo].[viewMaterialPlanningList]
AS
		SELECT TOP (100) PERCENT M.MATERIALID,
			   M.MATERIALDESC,			  
			   ISNULL(MaterialPlanning.RMINVENTORY, 0) AS RMINVENTORY,
			   ISNULL(MaterialPlanning.RMONORDER, 0) + ISNULL(RequestedQTY.InPurchase, 0) AS RMONORDER,
			   ISNULL(DemandQTY.INPPRODUCTION, 0) AS INPPRODUCTION,
			   ISNULL(MaterialPlanning.RMINVENTORY, 0) + ISNULL(MaterialPlanning.RMONORDER, 0) 
					+ ISNULL(RequestedQTY.InPurchase, 0) - ISNULL(DemandQTY.INPPRODUCTION, 0) AS AVAILABLE,
			   NeededBy.EarliestDateNeeded,
			   M.MATERIALUOM
		FROM dbo.MATERIAL AS M
		LEFT OUTER JOIN
            (SELECT SUM(CASE WHEN ((INVENTORYCLASS = 2) AND ((ITEMSTATUS = 'IN PROCESS'))) THEN ISNULL(UNITSREMAINING, 0) ELSE 0 END) AS RMINVENTORY, 
					SUM(CASE WHEN ((INVENTORYCLASS = 2) AND (ITEMSTATUS IN ('PENDING', 'INPROD'))) THEN ISNULL(UNITSREMAINING, 0) ELSE 0 END) AS RMONORDER, 
					MATERIALID
				FROM (SELECT DISTINCT dbo.INVITEM.INVITEMNUMBER, 
							dbo.INVITEM.UNITSREMAINING, 
							dbo.INVITEM.ITEMSTATUS, 
							dbo.INVITEM.INVENTORYCLASS, 
							dbo.INVITEM.ALLOCATEDDOCUMENT, 
							dbo.MATERIALPRODUCT.MATERIALID
						FROM dbo.INVITEM
						INNER JOIN dbo.MATERIALPRODUCT
						ON dbo.INVITEM.PRODUCTID = dbo.MATERIALPRODUCT.PRODUCTID
					) AS Inv GROUP BY MATERIALID
			) AS MaterialPlanning
			ON M.MATERIALID = MaterialPlanning.MATERIALID
		LEFT OUTER JOIN
            (SELECT     SUM(ISNULL(QTY, 0)) AS INPPRODUCTION,
					MATERIALID
				FROM          dbo.PRODITEM
				WHERE      (ISCOMPLETE = 0)
				GROUP BY MATERIALID
			) AS DemandQTY
			ON M.MATERIALID = DemandQTY.MATERIALID
		LEFT OUTER JOIN
			(SELECT MIN(PO.NEEDEDBY) AS EarliestDateNeeded, 
					PRI.MATERIALID
					FROM dbo.PRODORDER AS PO
					INNER JOIN dbo.MATERIALPRODUCT AS MP
						ON MP.PRODUCTID = PO.PRODUCTID
					INNER JOIN dbo.PRODITEM AS PRI
						ON PRI.MATERIALID = MP.MATERIALID
					WHERE (PO.NEEDEDBY IS NOT NULL)
						AND (PRI.ISCOMPLETE = 0)
					GROUP BY PRI.MATERIALID
			) AS NeededBy
			ON NeededBy.MATERIALID = M.MATERIALID
		LEFT OUTER JOIN
            (SELECT SUM(ISNULL(QTY *(
						CASE
							WHEN ISNULL(PURCHASEITEM.UNITSINCONTAINER,0) > 0 THEN
								PURCHASEITEM.UNITSINCONTAINER
							ELSE PRODCOST.UNITS
						END
						), 0)) AS InPurchase,
					MATERIAL.MATERIALID
				FROM dbo.PURCHASEITEM
				INNER JOIN MATERIALPRODUCT
					ON PURCHASEITEM.ITEMID = MATERIALPRODUCT.PRODUCTID
				INNER JOIN MATERIAL
					ON MATERIALPRODUCT.MATERIALID = MATERIAL.MATERIALID
				LEFT OUTER JOIN 
				(
					SELECT CASE
							WHEN COSTMETHOD = 'VOLUME' THEN
								VOLUMEUNITS
							WHEN COSTMETHOD = 'WEIGHT' THEN
								WEIGHTUNITS
						END AS UNITS,
						PRODUCTCOST.PRODUCTID
					FROM PRODUCTCOST
					INNER JOIN 
					(
						SELECT PRODUCTID,
							MAX(PRODUCTCOST.COSTRECID) AS COSTRECID
						FROM PRODUCTCOST
						WHERE ISACTIVE = 1
						GROUP BY PRODUCTID
					) AS ActiveCost
						ON ActiveCost.COSTRECID = PRODUCTCOST.COSTRECID
				) AS PRODCOST
					ON PRODCOST.PRODUCTID = PURCHASEITEM.ITEMID
				WHERE PURCHASEITEM.PURCHASEITEMSTATUS = 'REQUESTED'
					AND PURCHASEITEM.PURCHASEITEMTYPE IN ('REGULAR', 'MATERIAL')
				GROUP BY MATERIAL.MATERIALID
			) AS RequestedQTY
			ON M.MATERIALID = RequestedQTY.MATERIALID
		ORDER BY M.MATERIALID

GO

IF OBJECT_ID ('viewRptPOFulfillmentPlan', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptPOFulfillmentPlan] 
END
GO
CREATE VIEW [dbo].[viewRptPOFulfillmentPlan]
AS
SELECT DISTINCT W.WORKORDERNUMBER,
	WI.ITEMID,
	POI.PRODORDERNUM,
	POI.QTY,
	POI.UOM,
	POI.MATERIALID,
	M.MATERIALDESC,
	PO.PRODUCTID,
	P.PRODUCTDESC,
	P.CONTAINER,
	PO.PRODUCTQTY,
	CONVERT(VARCHAR,COALESCE(PO.PRODORDERNUM,'')) + ' - ' + CONVERT(VARCHAR,COALESCE(PO.PRODUCTQTY,'')) + ' - ' + CONVERT(VARCHAR,COALESCE(PO.PRODUCTID,'')) + ' - ' + COALESCE(P.PRODUCTDESC,'') + ' - ' + COALESCE(P.CONTAINER,'') AS ProductionOrderDetails,
	ISNULL(MaterialPlanning.RMINVENTORY, 0) AS RMINVENTORY,
	ISNULL(MaterialPlanning.RMONORDER, 0) AS RMONORDER,
	ISNULL(DemandQTY.INPPRODUCTION, 0) AS INPPRODUCTION,
	ISNULL(MaterialPlanning.RMINVENTORY, 0) + ISNULL(MaterialPlanning.RMONORDER, 0) - ISNULL(DemandQTY.INPPRODUCTION, 0) AS AVAILABLE
FROM WORKORDER W
	INNER JOIN WORKORDERITEM WI ON WI.WORKORDERNUMBER = W.WORKORDERNUMBER
	INNER JOIN viewWorkOrderAvailableSourceStatus Avail ON Avail.WORKORDERITEMNUMBER = WI.WORKORDERITEMNUMBER
	INNER JOIN PRODORDER PO ON PO.PRODORDERNUM = Avail.SOURCEDOCUMENT AND Avail.SOURCETYPE = 'PORD'
	INNER JOIN PRODITEM POI ON POI.PRODORDERNUM = PO.PRODORDERNUM
	INNER JOIN MATERIAL M ON M.MATERIALID = POI.MATERIALID
	LEFT JOIN PRODUCT P ON P.PRODUCTID = PO.PRODUCTID
	LEFT JOIN 
		(SELECT      SUM(CASE WHEN ((INVENTORYCLASS = 2) AND ((ITEMSTATUS = 'IN PROCESS'))) THEN ISNULL(UNITSREMAINING, 0) ELSE 0 END) AS RMINVENTORY, 
					SUM(CASE WHEN ((INVENTORYCLASS = 2) AND (ITEMSTATUS IN ('PENDING', 'INPROD'))) THEN ISNULL(UNITSREMAINING, 0) ELSE 0 END) AS RMONORDER, 
					MATERIALID
        FROM          (SELECT DISTINCT 
                                dbo.INVITEM.INVITEMNUMBER, dbo.INVITEM.UNITSREMAINING, dbo.INVITEM.ITEMSTATUS, dbo.INVITEM.INVENTORYCLASS, dbo.INVITEM.ALLOCATEDDOCUMENT, 
                                dbo.MATERIALPRODUCT.MATERIALID
                        FROM   dbo.INVITEM INNER JOIN
                                dbo.MATERIALPRODUCT ON dbo.INVITEM.PRODUCTID = dbo.MATERIALPRODUCT.PRODUCTID) AS Inv
        GROUP BY MATERIALID) AS MaterialPlanning ON M.MATERIALID = MaterialPlanning.MATERIALID 
	LEFT JOIN 
		 (	SELECT     SUM(ISNULL(QTY, 0)) AS INPPRODUCTION, MATERIALID
			FROM          dbo.PRODITEM
			WHERE      (ISCOMPLETE = 0)
			GROUP BY MATERIALID) AS DemandQTY ON M.MATERIALID = DemandQTY.MATERIALID
	LEFT JOIN 
		(
			SELECT  SUM(CASE WHEN ISNULL(ISCOMPLETE,0) = 0 THEN ISNULL(QTY, 0) ELSE 0 END) AS INPPRODUCTION,MATERIALID
			FROM dbo.PRODITEM
			GROUP BY MATERIALID
		) AS INPPRODUCTIONQTY ON INPPRODUCTIONQTY.MATERIALID= M.MATERIALID


GO

IF OBJECT_ID ('viewProductExcludeMaterialProduct', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewProductExcludeMaterialProduct] 
END
GO

CREATE VIEW [dbo].[viewProductExcludeMaterialProduct]
AS
	SELECT PRODUCTID, PRODUCT.PRODUCTDESC, PRODUCT.CONTAINER 
	FROM PRODUCT 
	WHERE NOT EXISTS (SELECT 1 FROM MATERIALPRODUCT WHERE MATERIALPRODUCT.PRODUCTID = PRODUCT.PRODUCTID)

GO


/************************* viewRptWorkOrder *************************/
IF OBJECT_ID ('viewRptWorkOrder', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptWorkOrder] 
END

GO

CREATE VIEW [viewRptWorkOrder]
AS
SELECT dbo.WORKORDERITEM.WORKORDERITEMNUMBER, 
	dbo.WORKORDERITEM.WORKORDERNUMBER, 
	dbo.WORKORDERITEM.PRODUCTID, 
	dbo.WORKORDERITEM.QTY, 
	dbo.WORKORDERITEM.INVITEMNUMBER, 
	dbo.WORKORDERITEM.ITEMCOMMENTS, 
	dbo.WORKORDERITEM.LOTNUMBER, 
	dbo.WORKORDERITEM.WAREHOUSELOCATION, 
	dbo.WORKORDER.CUSTID, 
	dbo.CUSTOMER.CUSTNAME, 
	dbo.WORKORDER.SHIPADDRESS1, 
	dbo.WORKORDER.SHIPADDRESS2, 
	dbo.WORKORDER.SHIPCITY, 
	dbo.WORKORDER.SHIPSTATEPROV, 
	dbo.WORKORDER.SHIPPOSTALCODE, 
	dbo.WORKORDER.SHIPCOUNTRY, 
	dbo.WORKORDER.SHIPCONTACT, 
	dbo.WORKORDER.FREIGHTCARRIER, 
	dbo.WORKORDER.FOB, 
	dbo.WORKORDER.CUSTOMERPO, 
	dbo.WORKORDER.ORDERTERMS, 
	dbo.WORKORDER.DELIVERYDATE, 
	dbo.WORKORDER.PLANNEDSHIPDATE, 
	dbo.WORKORDER.HOWRECEIVED, 
	dbo.WORKORDER.ORDERSTATUS, 
	dbo.WORKORDER.ORDERNOTES, 
	dbo.WORKORDER.WORKORDERDATE, 
	dbo.WORKORDER.PREPAREDBY, 
	dbo.WORKORDER.SUPPLIERCOMPANY,
	dbo.PRODUCT.PRODUCTDESC, 
	dbo.PRODUCT.STDGALLONS, 
	dbo.PRODUCT.STDWEIGHT,
	dbo.PRODUCT.CONTAINER, 
	(dbo.PRODUCT.STDWEIGHT + 
		CASE
			WHEN dbo.CONTAINER.TareWeight > 0
			THEN dbo.CONTAINER.TareWeight
			ELSE 0 END) 
		* dbo.WORKORDERITEM.QTY AS GROSSWEIGHT, 
	dbo.viewWorkOrderAvailableSourceStatus.SOURCETYPE, 
	dbo.viewWorkOrderAvailableSourceStatus.SOURCEDOCUMENT, 
	dbo.WORKORDER.CREATEDBY, 
	dbo.WORKORDER.PRODFULFILLMENTNOTES, 
	dbo.WORKORDER.TRANSPORTTYPE, 
	dbo.WORKORDER.ORDERTYPE, 
	dbo.WORKORDERITEM.CUSTITEMID, 
	dbo.WORKORDERITEM.PRICEUNITS, 
	dbo.WORKORDERITEM.PRICEUOM, 
	dbo.WORKORDERITEM.UNITPRICE, 
	dbo.WORKORDERITEM.STANDARDCOSTUNITS, 
	dbo.WORKORDERITEM.STANDARDCOSTUOM, 
	dbo.WORKORDERITEM.STANDARDUNITCOST, 
	dbo.WORKORDERITEM.ACTUALCOSTUNITS, 
	dbo.WORKORDERITEM.ACTUALCOSTUOM, 
	dbo.WORKORDERITEM.ACTUALUNITCOST
FROM dbo.CUSTOMER
INNER JOIN dbo.WORKORDER
	ON dbo.CUSTOMER.CUSTID = dbo.WORKORDER.CUSTID
INNER JOIN dbo.WORKORDERITEM
	ON dbo.WORKORDER.WORKORDERNUMBER = dbo.WORKORDERITEM.WORKORDERNUMBER
INNER JOIN dbo.PRODUCT
	ON dbo.WORKORDERITEM.PRODUCTID = dbo.PRODUCT.PRODUCTID	
INNER JOIN dbo.CONTAINER
	ON dbo.PRODUCT.CONTAINER = dbo.CONTAINER.Container
INNER JOIN dbo.viewWorkOrderAvailableSourceStatus
	ON dbo.viewWorkOrderAvailableSourceStatus.WORKORDERITEMNUMBER = dbo.WORKORDERITEM.WORKORDERITEMNUMBER

GO



/*********************************** Relabel **********************************/


IF OBJECT_ID ('viewRelabelOrder', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRelabelOrder] 
END
GO

CREATE VIEW [dbo].[viewRelabelOrder]
AS
SELECT  ro.[RELABELORDERNUMBER],
		ro.[RELABELORDERDATE],
		ro.[QTY],
		ro.[ITEMID],
		P.PRODUCTDESC AS ITEMDESC,
		P.[UOM],
		ro.[NEEDEDBY],
		P.[CONTAINER],
		ro.[WORKORDERNUMBER],
		ro.[RELABELORDERSTATUS],
		c.CUSTNAME
	FROM	[dbo].[RELABELORDER] ro
	LEFT JOIN CUSTOMER c ON RO.CUSTID = c.CUSTID
	LEFT JOIN PRODUCT P ON P.PRODUCTID = ro.ITEMID

GO

IF OBJECT_ID ('viewRptRelabelOrder', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptRelabelOrder] 
END
GO

CREATE VIEW [dbo].[viewRptRelabelOrder]
AS
SELECT    ro.[RELABELORDERNUMBER],
	ro.[RELABELORDERDATE],
	p.[PRODUCTID],        
	ro.[QTY],      
	ro.[NEEDEDBY],
	ro.[ITEMID],
	P.PRODUCTDESC AS ITEMDESC,
	P.CONTAINER,        
	ro.[WORKORDERNUMBER],    
	roi.[WORKORDERITEMNUMBER],
	ro.[RELABELORDERSTATUS],    
	roi.[RELABELORDERITEMNUMBER],
	ro.CUSTID,
	c.CUSTNAME,
	roi.ITEMID AS RELABELORDERITEMPRODUCTID,
	P1.PRODUCTDESC AS RELABELORDERITEMPRODUCTDESC,
	P1.CONTAINER AS RELABELORDERITEMCONTAINER,
	roi.SOURCETYPE,
	PRCH.PURCHASENUMBER AS SOURCEDOC,
	roi.INVITEMNUM,
	inv.ITEMSTATUS
FROM RELABELORDER ro
INNER JOIN RELABELORDERITEM roi ON ro.RELABELORDERNUMBER = roi.RELABELORDERNUMBER
LEFT OUTER JOIN CUSTOMER c ON RO.CUSTID = c.CUSTID
LEFT OUTER JOIN PRODUCT P ON P.PRODUCTID = ro.ITEMID    
LEFT OUTER JOIN PRODUCT P1 ON P1.PRODUCTID = roi.ITEMID
LEFT OUTER JOIN PURCHASEITEM PRCH ON PRCH.PURCHASEITEMID = roi.SOURCEDOC AND roi.SOURCETYPE = 'PRCH'
LEFT OUTER JOIN INVITEM inv ON inv.INVITEMNUMBER = roi.INVITEMNUM

GO

IF OBJECT_ID ('viewRelabelOrderItem', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRelabelOrderItem] 
END
GO

CREATE VIEW [dbo].[viewRelabelOrderItem]
AS
SELECT     roi.RELABELORDERNUMBER, roi.ITEMID, P.PRODUCTDESC AS ITEMDESC, P.CONTAINER, roi.INVITEMNUM, roi.WORKORDERITEMNUMBER, roi.SOURCETYPE, 
                      roi.SOURCEDOC, roi.RELABELORDERITEMSTATUS, roi.RELABELORDERITEMNUMBER
FROM         dbo.RELABELORDER AS ro INNER JOIN
                      dbo.RELABELORDERITEM AS roi ON ro.RELABELORDERNUMBER = roi.RELABELORDERNUMBER LEFT OUTER JOIN
                      dbo.PRODUCT AS P ON P.PRODUCTID = roi.ITEMID

GO

IF OBJECT_ID ('viewRelabelOrderProduct', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRelabelOrderProduct] 
END
GO


CREATE VIEW [dbo].[viewRelabelOrderProduct]
AS
SELECT DISTINCT	p.PRODUCTID, 
	p.PRODUCTDESC, 
	p.CONTAINER, 
	p.UNITS, 
	p.UOM 
FROM	PRODUCTFULFILLMENTPLAN pfp
	INNER JOIN PRODUCT p ON pfp.PRODUCTID = P.PRODUCTID
WHERE	FULFILLMENTTYPEID = 2


GO

IF OBJECT_ID ('viewRptRelabelFulfillmentPlan', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewRptRelabelFulfillmentPlan] 
END
GO

CREATE VIEW viewRptRelabelFulfillmentPlan 
AS 

WITH FulfillmentReport_CTE (WORKORDERNUMBER, RLBLUOM, RLBLIITEMID, RLBLIITEMDESC, RLBLCONTAINER, RLBLSTATUS, RLBLDATENEEDED, RLBLORDDETAILS)
AS
-- Define the CTE query.
(
SELECT W.WORKORDERNUMBER,
	P1.UOM AS RLBLUOM, 
	RLBLORDI.ITEMID AS RLBLIITEMID, 
	P1.PRODUCTDESC AS RLBLIITEMDESC,  
	P1.CONTAINER AS RLBLCONTAINER , 
	RLBLORDI.RELABELORDERITEMSTATUS AS RLBLSTATUS, 
	RLBL.NEEDEDBY AS RLBLDATENEEDED,
	CONVERT(VARCHAR,COALESCE(RLBL.ITEMID,'')) + ' - ' + CONVERT(VARCHAR,COALESCE(P.PRODUCTDESC,'')) + ' - ' + CONVERT(VARCHAR,COALESCE(P.CONTAINER,'')) AS RLBLORDDETAILS
FROM WORKORDER W 
INNER JOIN WORKORDERITEM WI ON WI.WORKORDERNUMBER = W.WORKORDERNUMBER 
INNER JOIN RELABELORDERITEM RLBLORDI ON RLBLORDI.RELABELORDERITEMNUMBER = WI.SOURCEDOCUMENT AND WI.SOURCETYPE = 'RLBL'  
INNER JOIN RELABELORDER RLBL ON RLBL.RELABELORDERNUMBER = RLBLORDI.RELABELORDERNUMBER  
LEFT JOIN PRODUCT P ON P.PRODUCTID = RLBL.ITEMID  
LEFT JOIN PRODUCT P1 ON P1.PRODUCTID = RLBLORDI.ITEMID
)

SELECT WORKORDERNUMBER, 
	COUNT(*) AS RLBLQTY,
	RLBLUOM,
	RLBLIITEMID,
	RLBLIITEMDESC,
	RLBLCONTAINER,
	RLBLSTATUS,
	RLBLDATENEEDED,
	RLBLORDDETAILS
FROM FulfillmentReport_CTE
GROUP BY WORKORDERNUMBER,
	RLBLUOM,
	RLBLIITEMID,
	RLBLIITEMDESC,
	RLBLCONTAINER,
	RLBLSTATUS,
	RLBLDATENEEDED,
	RLBLORDDETAILS

GO

IF OBJECT_ID ('viewProductRelabelInstruction', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewProductRelabelInstruction] 
END

GO

CREATE VIEW [dbo].[viewProductRelabelInstruction]
AS
SELECT Fulfill.PRODUCTID,
	Fulfill.ASSOCIATEDPRODUCTID,
	Ins.SEQUENCE,
	Ins.RELABELINSTRUCTION,
	Ins.FULFILLMENTPLANID
FROM PRODUCTRELABELINSTRUCTION Ins
INNER JOIN PRODUCTFULFILLMENTPLAN Fulfill
	ON Ins.FULFILLMENTPLANID = Fulfill.FULFILLMENTPLANID

GO

IF OBJECT_ID ('viewTestSamples', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewTestSamples] 
END

GO

CREATE VIEW [dbo].[viewTestSamples]
AS
SELECT     i.INVITEMNUMBER, i.PRODUCTID, p.PRODUCTDESC, p.CONTAINER, i.LOTNUMBER, i.ITEMSTATUS, t.TESTSAMPLEKEY, t.TESTTIME, t.TESTEDBY, t.TEMPERATURE, 
                      t.PHRESULT, t.PHRANGELOW, t.PHRANGEHIGH, t.PHACCEPTED, t.SGRESULT, t.SGRANGELOW, t.SGRANGEHIGH, t.SGACCEPTED, t.COLOR, t.CLARITY, t.ODOR, 
                      t.APPEARANCE, t.FREEFLOWING, t.PASSEDTIME, t.PASSEDBY, t.PASSEDTEST
FROM         dbo.INVITEM AS i INNER JOIN
                      dbo.PRODUCT AS p ON i.PRODUCTID = p.PRODUCTID INNER JOIN
                      dbo.TESTSAMPLE AS t ON i.TESTSAMPLEKEY = t.TESTSAMPLEKEY

GO

IF OBJECT_ID ('viewMissingProductStandards', 'V') IS NOT NULL
BEGIN
	DROP VIEW [viewMissingProductStandards] 
END

GO

CREATE VIEW [dbo].[viewMissingProductStandards]
AS
SELECT     PRODUCTID, PRODUCTDESC, CONTAINER, PHRANGELOW, PHRANGEHIGH, SGRANGELOW, SGRANGEHIGH, NEEDSTESTING, CHEMICALCOLOR, 
                      CHEMICALCLARITY
FROM         dbo.PRODUCT
WHERE     (PHRANGELOW IS NULL) AND (NEEDSTESTING = 1) OR
                      (NEEDSTESTING = 1) AND (PHRANGEHIGH IS NULL) OR
                      (NEEDSTESTING = 1) AND (SGRANGELOW IS NULL) OR
                      (NEEDSTESTING = 1) AND (SGRANGEHIGH IS NULL) OR
                      (NEEDSTESTING = 1) AND (CHEMICALCOLOR IS NULL) OR
                      (NEEDSTESTING = 1) AND (CHEMICALCLARITY IS NULL)

GO
